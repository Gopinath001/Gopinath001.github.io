<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content=noodp><meta name=author content=Bluepie><meta name=description content="Public Journal of aghontpi"><meta name=keywords content="aghontpi bluepie Journal"><link rel=prev href=//bluepie.in/2023/01/updating-dns-servers-for-ads-and-tracking-protection-in-2023/><link rel=next href=//bluepie.in/2023/08/birthday-month-reflection/><link rel=canonical href=//bluepie.in/2023/03/android-ci/><link rel=apple-touch-icon sizes=180x180 href=//bluepie.in/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=//bluepie.in/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=//bluepie.in/favicon-16x16.png><link rel=manifest href=//bluepie.in/site.webmanifest><link rel=mask-icon href=//bluepie.in/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content=#da532c><meta name=theme-color content=#ffffff><title>Android CI on Github | Bluepie&#39;s Journal</title><meta name=title content="Android CI on Github | Bluepie's Journal"><link rel=stylesheet href=//bluepie.in/font/iconfont.css><link rel=stylesheet href=//bluepie.in/css/main.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"\/\/bluepie.in\/"},"articleSection":"posts","name":"Android CI on Github","headline":"Android CI on Github","description":"Been busy, its not like I lost interest in posting here, I just didn\x26rsquo;t allocate time for writing here, which is the opposite of what I set out to do.. which in turn does not track my progress at all, I should be held accountable for my progress. ~pff I hate it.\nA friend told me in the time that I did not post, not necessarily everything should be a progress, maybe this is right or maybe wrong.","inLanguage":"en-us","author":"Bluepie","creator":"Bluepie","publisher":"Bluepie","accountablePerson":"Bluepie","copyrightHolder":"Bluepie","copyrightYear":"2023","datePublished":"2023-03-12 00:08:06 \x2b0000 UTC","dateModified":"2023-03-12 00:08:06 \x2b0000 UTC","url":"\/\/bluepie.in\/2023\/03\/android-ci\/","wordCount":"986","keywords":["Bluepie\x27s Journal"]}</script><script type=text/javascript>(function(c,l,a,r,i,t,y){c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);})(window,document,"clarity","script","9oioq6tja4");</script></head><body><div class=wrapper><nav class=navbar><div class=container><div class="navbar-header header-logo"><a href=javascript:void(0); class=theme-switch><i class="extra extra-moon"></i></a>&nbsp;<a href=//bluepie.in/>Bluepie&#39;s Journal</a></div><div class="menu navbar-right"><a class=menu-item href=//bluepie.in/posts/>Journal entries</a>
<a class=menu-item href=//bluepie.in/categories/>Categories</a></div></div></nav><nav class=navbar-mobile id=nav-mobile style=display:none><div class=container><div class=navbar-header><div><a href=javascript:void(0); class=theme-switch><i class="extra extra-moon"></i></a>&nbsp;<a href=//bluepie.in/>Bluepie&#39;s Journal</a></div><div class=menu-toggle><span></span><span></span><span></span></div></div><div class=menu id=mobile-menu><a class=menu-item href=//bluepie.in/posts/>Journal entries</a>
<a class=menu-item href=//bluepie.in/categories/>Categories</a></div></div></nav><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-135013873-2','auto');ga('send','pageview');}</script><main class=main><div class=container><article class=post-warp itemscope itemtype=http://schema.org/Article><header class=post-header><h1 class=post-title itemprop="name headline">Android CI on Github</h1><div class=post-meta>Written by <a itemprop=name href=//bluepie.in/ rel=author>Bluepie</a> with â™¥
<span class=post-time>on <time datetime=2023-03-12 itemprop=datePublished>March 12, 2023</time></span>
in
<i class="iconfont icon-folder"></i><span class=post-category><a href=//bluepie.in/categories/tech/>Tech</a>
<a href=//bluepie.in/categories/continuous-integration/>Continuous Integration</a>
<a href=//bluepie.in/categories/ci/>CI</a>
<a href=//bluepie.in/categories/android/>Android</a>
<a href=//bluepie.in/categories/github/>Github</a></span></div></header><div class=post-content><img src=//bluepie.in/images/posts/android-ci/github-ci-status.png class=featured_image><p>Been busy, its not like I lost interest in posting here, I just didn&rsquo;t allocate time for writing here, which is the opposite of what I set out to do.. which in turn does not track my progress at all, I should be held accountable for my progress. ~pff I hate it.</p><p>A friend told me in the time that I did not post, not necessarily everything should be a progress, maybe this is right or maybe wrong..only time will tell. (Meaning sometimes you can just relax, but to be honest.. I was not releaxing aswell)</p><h2 id=why-about>Why &amp; About</h2><p>This is going to short, Recently I created a CI for development android builds, this is to reduce &amp; eliminate the manuall build process to every pr, this reduces a lot of time for me.</p><blockquote><p>so what does this do?</p></blockquote><p>When a Pull Request is made to <code>development</code> or <code>master</code> branch, a CI will trigger that will pull all the latest code from that branch and try to build the code in <code>dev</code> mode, it will report whether tests and build is success and export the final apk. This will be helpful for testers and even me to take the build right away and check whether the code breaks the build or not. Additionally I dont have to manually make a comment everytime for testers to take the build.</p><h2 id=android-ci-with-github-actions>Android CI with github actions</h2><p>GitHub Actions is a continuous integration and continuous delivery (CI/CD) platform that allows to automate builds, test, and deployment pipeline. We can create workflows that build and test every pull request to our repositories.</p><h3 id=github-actions-free-tier>Github actions free tier</h3><p>GitHub Actions are unlimited for public repositories and the Free plan also provides 2,000 minutes of Actions each month for use with out private projects.</p><p><figure><img src=//bluepie.in/images/ring.svg data-sizes=auto data-src=//bluepie.in/images/posts/android-ci/github-free-account.png alt class=lazyload><figcaption class=image-caption></figcaption></figure></p><p><figure><img src=//bluepie.in/images/ring.svg data-sizes=auto data-src=//bluepie.in/images/posts/android-ci/actions-for-private-reporsitories.png alt class=lazyload><figcaption class=image-caption></figcaption></figure></p><h3 id=gradle-build>Gradle build</h3><p>There are different variants of your application (release &amp; debug, each variant has its own set of porperties). But what do we need here? debug variant, because that is what we share with the users and get feedback from. I mainly wanted this because everytime I make a pull request, I have to check if it builds, take builds.. I then have to link the builds to that pull request, so others/ even I can use it and test that pull request.</p><p><strong>Commands</strong></p><p>debug: This is the specific variant of the application that is being built. In Android projects, you can define different build variants, such as debug and release, to configure different settings and behavior. The debug variant is typically used during development and testing, while the release variant is used for production-ready builds. (note that: for the debug build the sizes will be significantly big than release builds)</p><p>For example: <a href=https://github.com/aghontpi/ad-silence/blob/51fb5782f711388c6632fa2d762b4beded3c9320/app/build.gradle#L19-L33 rel="nofollow noreferrer" target=_blank>In my case I have these two builds</a></p><pre><code class=language-gradle>buildTypes {
    release {
        minifyEnabled true
        shrinkResources true

        proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'
    }

    debug {
        minifyEnabled true
        shrinkResources true

        proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'
    }
}
</code></pre><p>I just specifically need the debug build alone.</p><h2 id=what-is-a-keystore-why-do-we-need-it>What is a Keystore &amp; Why do we need it?</h2><p>A keystore plays a pivotal role in ensuring the security and integrity of our application. Essentially, a keystore is a secure store that holds cryptographic keys, certificates, and sensitive data used to digitally sign our App. These keys are used to digitally sign our App&rsquo;s APK file. This digital signature serves as a means to verify the authenticity and origin of your application. When a user installs an app, the Android system uses the keystore&rsquo;s digital signature to confirm that the App has not been tampered with and that it indeed originates from the expected source. This prevents malicious actors from altering the app&rsquo;s code and introducing potential security vulnerabilities.</p><p>To simply put, we need this to distribute our app builds, users can trust this build since it is from us.</p><p>This keystore file should be kept private, should not be shared with others and can not be comitted along with other files in the repository.</p><p><strong>If we keep this file private, how do we take builds then?</strong></p><p>This is where <a href=https://docs.github.com/en/actions/security-guides/encrypted-secrets rel="nofollow noreferrer" target=_blank>configuring secret in github actions</a> comes into play.</p><p><figure><img src=//bluepie.in/images/ring.svg data-sizes=auto data-src=//bluepie.in/images/posts/android-ci/configuring-secret-github-actions.png alt class=lazyload><figcaption class=image-caption></figcaption></figure></p><p><strong>Once the secrets are configured, it can be used like below</strong></p><pre><code class=language-yaml>- name: Decode keystore
  env:
    DEBUG_KEYSTORE: ${{ secrets.DEBUG_KEYSTORE }}
  run: |
    echo &quot;$DEBUG_KEYSTORE&quot; | base64 --decode &gt; debug.keystore
</code></pre><h2 id=configuring-the-workflow>Configuring the workflow</h2><ul><li>We set a name &amp; when should the builds be triggered, it can be of several things Cron, Issue Comment, Pull Request, Fork, Deployment Status..etc. See the <a href=https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows. rel="nofollow noreferrer" target=_blank>full list here</a></li></ul><p>For my usecase, what I specifically need here is <a href=https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#push rel="nofollow noreferrer" target=_blank>push</a></p><pre><code class=language-yaml>name: Android CI

on:
  push:
    branches: [ &quot;master&quot;, &quot;development&quot; ]
  pull_request:
    branches: [ &quot;master&quot;, &quot;development&quot; ]
</code></pre><p>Then we need to <a href=https://docs.github.com/en/actions/using-jobs/using-jobs-in-a-workflow rel="nofollow noreferrer" target=_blank>specify the jobs</a>, there can be multiple job, but in our case, we just need a build job, give it a name.</p><pre><code class=language-yaml>jobs:
  build:
</code></pre><p>Choosing <a href=https://docs.github.com/en/actions/using-jobs/choosing-the-runner-for-a-job rel="nofollow noreferrer" target=_blank>which type of machine</a> this should be run on.</p><pre><code class=language-yaml>runs-on: ubuntu-latest
</code></pre><p>A job contians sequence of tasks called <a href=https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions#jobsjob_idsteps rel="nofollow noreferrer" target=_blank>steps</a>.</p><p><strong>Checking out</strong></p><pre><code class=language-yaml>- name: checkout &amp; set up JDK 11
- uses: actions/checkout@v3
  uses: actions/setup-java@v3
  with:
    java-version: '11'
    distribution: 'temurin'
    cache: gradle
</code></pre><p><strong>Decode keystore from repository secrets</strong></p><pre><code class=language-yaml>- name: Decode keystore
  env:
    DEBUG_KEYSTORE: ${{ secrets.DEBUG_KEYSTORE }}
  run: |
    echo &quot;$DEBUG_KEYSTORE&quot; | base64 --decode &gt; debug.keystore
</code></pre><p><strong>Make gradle executable &amp; run gradle build</strong></p><pre><code class=language-yaml>- name: Grant execute permission for gradlew
  run: chmod +x gradlew

- name: Build with Gradle
  env:
    KEYSTORE_PASSWORD: ${{ secrets.KEYSTORE_PASSWORD }}
    KEY_ALIAS: ${{ secrets.KEYSTORE_ALIAS }}
    KEY_PASSWORD: ${{ secrets.KEY_PASSWORD }}
  run: ./gradlew assembleDebug -Pandroid.injected.signing.store.file=$(pwd)/debug.keystore -Pandroid.injected.signing.store.password=$KEYSTORE_PASSWORD -Pandroid.injected.signing.key.alias=$KEY_ALIAS -Pandroid.injected.signing.key.password=$KEY_PASSWORD
</code></pre><p>We inject the <code>debug.keystore</code> &amp; other environment variables into the build using params like <code>-Pandroid.injected.signing.store.file=$(pwd)/debug.keystore</code>.</p><p><strong>Upload the artifacts</strong></p><pre><code class=language-yaml>- name: Upload debug build
  uses: actions/upload-artifact@v3
  with: 
    name: &lt;upload-name&gt;.apk (build artifact)
    path: app/build/outputs/apk/debug/app-debug.apk

</code></pre><p><a href=https://github.com/aghontpi/ad-silence/blob/master/.github/workflows/android.yml rel="nofollow noreferrer" target=_blank>Full workflow file.</a></p><p><strong>Build in action</strong></p><p><figure><img src=//bluepie.in/images/ring.svg data-sizes=auto data-src=//bluepie.in/images/posts/android-ci/build-in-action.png alt class=lazyload><figcaption class=image-caption></figcaption></figure></p><h2 id=conclusion>Conclusion</h2><p>This enabled me to not care about dev-debug builds entirely and focus just on development, which is a great time save.</p><p>In future, I would create a separate releases named <code>nightly</code>, where the dev branch is built daily and these builds will be updated there.</p></div><div class=post-copyright><p class=copyright-item><span>Author:</span>
<span>Bluepie</span></p><p class=copyright-item><span>Link:</span>
<a href=//bluepie.in/2023/03/android-ci/>//bluepie.in/2023/03/android-ci/</span></p></div><div class=post-tags><section><a href=javascript:window.history.back();>back</a></span> Â·
<span><a href=//bluepie.in/>home</a></span></section></div><div class=post-nav><a href=//bluepie.in/2023/01/updating-dns-servers-for-ads-and-tracking-protection-in-2023/ class=prev rel=prev title="Updating Dns Servers for Ads and Tracking Protection in 2023"><i class="iconfont icon-left"></i>&nbsp;Updating Dns Servers for Ads and Tracking Protection in 2023</a>
<a href=//bluepie.in/2023/08/birthday-month-reflection/ class=next rel=next title="Birthday Month 2023, Reflection &amp; Goals">Birthday Month 2023, Reflection &amp; Goals&nbsp;<i class="iconfont icon-right"></i></a></div><div class=post-comment><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"gopinath001-github-io-blog"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></article></div></main><footer class=footer><div class=copyright>&copy;
<span itemprop=copyrightYear>2017 - 2025</span>
<span class=with-love>|</span>
<span class=author itemprop=copyrightHolder><a href=//bluepie.in/>Bluepie</a></span></div></footer><link href=//bluepie.in/css/lightgallery.min.css rel=stylesheet><script src=//bluepie.in/js/vendor_gallery.min.js async></script></div></body></html>