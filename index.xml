<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Bluepie&#39;s Journal on Bluepie&#39;s Journal</title><link>//bluepie.in/</link><description>Recent content in Bluepie&#39;s Journal on Bluepie&#39;s Journal</description><language>en-us</language><lastBuildDate>Thu, 21 Sep 2023 06:03:26 +0000</lastBuildDate><atom:link href="/" rel="self" type="application/rss+xml"/><item><title>Overcoming a limitation in Electron</title><link>//bluepie.in/2023/09/electron-views/</link><pubDate>Thu, 21 Sep 2023 06:03:26 +0000</pubDate><guid>//bluepie.in/2023/09/electron-views/</guid><description>
&lt;p&gt;Hey, what&amp;rsquo;s going on with you, hopefully good things, a small personal update, I think I lost focus on my goals for almost a 1.6 years, right after I joined vz, maybe its beause this is the first ime I ever switched my official day time job, wtf, time..time..time it moves soo fast, nowadays literally everthing takes soo much time in this attention seeking nightmare.. wtf, you can not even ignore most of the things, otherwise you will be an outcast, Something happened and it gave me a wakeup call on why I wanted my life goals on the first place, then I realized, &amp;ldquo;you are the person shaped by your memories, at least your behaviour should reflect it&amp;rdquo;, because If I still had my old memories and experiences I would have not changed courses? doing all the things that external factors influences me, my future self can agree or disagree on this.&lt;/p&gt;
&lt;h2 id=&#34;electron&#34;&gt;Electron&lt;/h2&gt;
&lt;p&gt;I haven&amp;rsquo;t worked in electron before, embedded view and browser views are three different ways to build the UI for your electron app&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;iframe tag&lt;/li&gt;
&lt;li&gt;webview tag&lt;/li&gt;
&lt;li&gt;BrowserView&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Officailly in the docs there is note asking people to not use webiew though, &lt;a href=&#34;https://www.electronjs.org/docs/latest/api/webview-tag#warning&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;&amp;ldquo;Important Note: we do not recommend you to use WebViews&amp;rdquo;&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;what-why&#34;&gt;What &amp;amp; why&lt;/h2&gt;
&lt;p&gt;Recently I&amp;rsquo;ve been tasked with creating an electron experience on my office job, sadly I can not talk about it though, but I can share how I solved some of the engineering problems though.&lt;/p&gt;
&lt;h2 id=&#34;this-post-is-gona-be-detailing-about&#34;&gt;This post is gona be detailing about,&lt;/h2&gt;
&lt;p&gt;Problem to solve:
Overcoming the lack of support of z-Index on Electron Views&lt;/p&gt;
&lt;h2 id=&#34;figma-design-views&#34;&gt;Figma design views&lt;/h2&gt;
&lt;p&gt;Maybe this can be solved in a different way, maybe there is even an official solution, but when I searched for zindex for browser views, there was not any solution.&lt;/p&gt;
&lt;p&gt;For the project, I needed to work with showing different views simultaneously at the same time.&lt;/p&gt;
&lt;p&gt;All the views are maintained and accessbile in electron api&amp;rsquo;s, In addition to that, I built a wrapper Class that track all the windows in the app, It also trackts what is the current active view.&lt;/p&gt;
&lt;h3 id=&#34;what-i-mean-by-main-view-current-active-view&#34;&gt;What I mean by main view/ current active view?&lt;/h3&gt;
&lt;p&gt;&lt;img src=&#34;//bluepie.in/images/posts/Solving an electron problem/view-expl-part-1.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Section labelled as &amp;ldquo;1&amp;rdquo; is like a sidebar to a website, its main purpose of it is to switch between showing content on section labelled as &amp;ldquo;2&amp;rdquo;.&lt;/li&gt;
&lt;li&gt;Both &amp;ldquo;1&amp;rdquo; &amp;amp; &amp;ldquo;2&amp;rdquo; are &lt;a href=&#34;https://www.electronjs.org/docs/latest/api/browser-view&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;BrowserViews&lt;/a&gt; positioned absolutely using &lt;a href=&#34;https://www.electronjs.org/docs/latest/api/browser-view#viewsetboundsbounds-experimental&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;set bounds&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;the-problem&#34;&gt;The problem&lt;/h3&gt;
&lt;p&gt;If the view for the left sidebar (section &amp;ldquo;1&amp;rdquo; from image) has to show a popup, that is beyound the bounds (width and height), the content in the view will be cut-off by the main view (section &amp;ldquo;2&amp;rdquo; of the image). In browser if we were to do this, we can set &lt;code&gt;z-index&lt;/code&gt; to overcome the issue, this is true even for electron, if we have used the &lt;code&gt;iframe&lt;/code&gt; instead of &lt;code&gt;BrowserView&lt;/code&gt;,&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;//bluepie.in/images/posts/Solving an electron problem/view expl - part 3.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
&lt;h3 id=&#34;solution&#34;&gt;Solution&lt;/h3&gt;
&lt;p&gt;Since &lt;code&gt;BrowserViews&lt;/code&gt; does not have &lt;code&gt;z-index&lt;/code&gt;, I have to find a different solution. In &lt;code&gt;BrowserView&lt;/code&gt; the last added window is always placed on top of other windows. So this is the reason, the sidebar view (section 1) has its view (view that is out of bounds) cut-off. But luckly we have this &lt;a href=&#34;https://www.electronjs.org/docs/latest/api/browser-window#winsettopbrowserviewbrowserview-experimental&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;api (setTopBrowserView)&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;[API definition] - win.setTopBrowserView(browserView)&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Raises browserView above other BrowserViews attached to win. Throws an error if browserView is not attached to win.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Using &lt;code&gt;setTopBrowserView&lt;/code&gt; I can make the sidebar view to come front, wheneven I want to show a popup or any view that is out of bounds (width and height exceeds the bounds in the view).&lt;/p&gt;
&lt;h3 id=&#34;how-do-we-do-this&#34;&gt;How do we do this?&lt;/h3&gt;
&lt;p&gt;For my usecase, I wanted to show a popup that will be out of bounds when user interacts with the contents of the sidebar, so I have a trigger which I can use when to show or hide out of bounds contents.&lt;/p&gt;
&lt;p&gt;I can listen for mouse events on the side bar view (section &lt;code&gt;1&lt;/code&gt; from the image), whenever the mouse enters the sidebar view I can use &lt;code&gt;setTopBrowserView&lt;/code&gt; to set sidebarview as the &lt;code&gt;top&lt;/code&gt; view.&lt;/p&gt;
&lt;p&gt;Now all the contents. Normal and out of bounds contents are visible, as it is the top view.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;//bluepie.in/images/posts/Solving an electron problem/view expl - part 2.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;On mouse leave, I can then set the original view that was top view to reset the behaviour.&lt;/p&gt;
&lt;h3 id=&#34;how-do-we-do-this-in-react&#34;&gt;How do we do this in react?&lt;/h3&gt;
&lt;p&gt;Code is pretty straight forward and will make it easy to understand the logic.&lt;/p&gt;
&lt;p&gt;render part&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-jsx&#34;&gt;&amp;lt;div
...
ref={divListenerRef}
&amp;gt;
...
...
...
&amp;lt;/div&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;setting up the mouse enter and mouse leave triggers&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-js&#34;&gt;useEffect(() =&amp;gt; {
if (divListenerRef &amp;amp;&amp;amp; divListenerRef.current) {
console.debug(&#39;[setting bounds triggers]&#39;);
divListenerRef.current.addEventListener(&#39;mouseenter&#39;, callbackToExpand);
divListenerRef.current.addEventListener(&#39;mouseleave&#39;, callbackToRestrict);
}
return () =&amp;gt; {
if (divListenerRef.current) {
console.debug(&#39;[cleaning up triggers]&#39;);
divListenerRef.current.removeEventListener(&#39;mouseenter&#39;, callbackToExpand);
divListenerRef.current.removeEventListener(&#39;mouseleave&#39;, callbackToRestrict);
}
};
}, [popupCoordinates, popupProfile]);
#popupCoordinates, popupProfile are just x,y values &amp;amp; status, whether to show or hide the popup
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;like I said code is self explanatory.
I&amp;rsquo;ve had this in draft for over couple of months now.. I wanted to check office laptop to refer my code to be accurate, finally had the urge to open office laptop..at 408am.
like I said in the begining personal udpate.&lt;/p&gt;
&lt;h2 id=&#34;conclusion&#34;&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;Electron is fun, using exisiting tech that we already know to speed up the dev process to deliver quick.. maybe I will cover bundling/building in a diff post..if I feel that I can contribute something different than what is already present all over the internet.&lt;/p&gt;
&lt;p&gt;I made the bad desicision of looking back into my past.. I shouldn&amp;rsquo;t have.. and tried to make contact.. why did I do that? (not influenced by core belief&amp;hellip;suggestions?) by the time I got a response, I was already regretting and back to my current self of just moving forward. all happended in july (remember future me!)&lt;/p&gt;
&lt;p&gt;The thing about memories,it has proven me once again. Since I started to write..complete and had this post in draft for months, I already forgot a lot.. if I remembered all the things from the begining paragraph while making decisions over the last months, I would have made differnet decisions. Memory is really important to _ your _ &amp;amp; _.. (future me remebers?) maybe I can build something for me that keeps track of all these.. with a search user interface and a keyword.. so I can make an informed decision?? google tasks, keep already do this.. no?..something to think about for me. Hope future me reads this and realises how important some small things can be.&lt;/p&gt;</description></item><item><title>Birthday Month 2023, Reflection &amp; Goals</title><link>//bluepie.in/2023/08/birthday-month-reflection/</link><pubDate>Mon, 21 Aug 2023 02:06:53 +0000</pubDate><guid>//bluepie.in/2023/08/birthday-month-reflection/</guid><description>
&lt;p&gt;This is personal post, not about tech.. if anyone other than me is reading this.. ignore this if you wanted somehting technical.&lt;/p&gt;
&lt;p&gt;I can not belive, its been already 3 years &lt;a href=&#34;https://bluepie.in/2020/08/future/&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;since this post&lt;/a&gt;. Covid really took 2 years from my life real quick. I dont know If I&amp;rsquo;d be in a better/ lesser position if it were not for covid though.&lt;/p&gt;
&lt;p&gt;I started this draft on august 21 and as i am inching each day towards my birthday and beyond. okey so lets compare the posts from previous years, my predictions and what not.&lt;/p&gt;
&lt;p&gt;I did a purchase with a huge sum of money, atleast my own money without the help/assistance of my parents, so it felt pretty good. Sometimes I think maybe its a bad idea? cuz some of the suggestions when I told others were invest it somewhere else and buy it through other means. Like I always say only future holds the truth.&lt;/p&gt;
&lt;h2 id=&#34;reflection&#34;&gt;Reflection&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;For my future self&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Idk I feel like my judgement is clouded and I got distracted from my life/long term goal of comitting to open source.. or wait till you hear this delusionsal reasoning.. of maybe..maybe I might have leveled up and found something else? maybe.. Im doing a lot of travel back and forth.. and now since I&amp;rsquo;be been living with a close friend of mine in the work location, I had to socialize more.. which is not a bad thing.. I can not just sitback.. thinking and typing away on my keyboard.. while they were in the same/next room&amp;hellip;&lt;/p&gt;
&lt;p&gt;Its like a limbo [removed&amp;hellip;]&lt;/p&gt;
&lt;p&gt;Encrypting below and not removing, if future me forgets for some reason.&lt;/p&gt;
&lt;p&gt;&amp;ldquo;U2FsdGVkX1+Z+HeoqIwG5YyizCq6IyINO1be3KxOWWzx6y1rvURg/YAzbhy0SxxQ
HW3q9sdbRWrNTE57PJBcZFwVtT7NuGjLMPjiSxF1KnaTZ3JULiKbO+riM+TkkxfI
Z0Yh2BKpSF/HRgdjI787sWXiShmJksyM+itfyO6PkcuI5Qiglq7on+ZzkOqbGID7
Gj34igwMbpFQOxUzgtC9H6dIeUzTXjxlqPExZXaGtGxVBlQIHtAekFs8igqG3yn3
OWNHmfbtBHcsA57i4CjOLnJ2VabrLkFX/oym0+6E8aQNiYYZtVf0dlRaAhTcE/vm&amp;rdquo;&lt;/p&gt;
&lt;p&gt;&amp;ldquo;U2FsdGVkX1+fnI5zDIHyEW0/HpvcfBw1dj7tPcFafQv8HXxlxffZgoluZx9tG7jP
DZpgSrGa4Uq9CJbCvlin+yLMt7b7SFKRJt7xNkDXO0efAkZnXy/xPWWWA2ZXeUGq
DN5YzMv6rLtXMISiFzNZHUMiq04mj0qyHAyxZQOLjwA=&amp;rdquo;&lt;/p&gt;
&lt;p&gt;&amp;ldquo;U2FsdGVkX19MbTbNNHu3p/uw0g+n4qUWxUhn9cbTLU75sG5oayaiiEoJ86S5O9NQ
zRlF8ODh/y/Z/V0NF/6CTZyAyZKKw91ZtDt9lnCBaMijPUoCL2ShOmSm/ewRP8Q3
Gjrb5A6Ml8xvhhuomeH37njHWg3112JR+zhJzJ1A+nXB8AJ9uyBhew+F0FYtNDu4
AhPfDk1Kxs18nKkIs5cOZPptQ8p4fM8fOrvlxZOMdVwHOpCi7pnrHxf0aaBTFoy8
1skzdWQ5C7k18lPAZig1cg==&amp;rdquo;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;#OpenSSL 3.1.2 1 Aug 2023 (Library: OpenSSL 3.1.2 1 Aug 2023)
#enc
echo -n &amp;quot;string-to-encrypt&amp;quot; | openssl enc -aes-256-cbc -a -pbkdf2
#dec
echo -n &amp;quot;string-to-decrypt&amp;quot; | base64 -d | openssl enc -d -aes-256-cbc -A -pbkdf2
#incorrect password will print random symbols
&lt;/code&gt;&lt;/pre&gt;
&lt;hr /&gt;
&lt;p&gt;&lt;img src=&#34;//bluepie.in/images/posts/birthday-month-and-reflection/post-from-august-2019.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;above text from the images is from 4 years ago, like wtf&amp;hellip; I can not grasp time..&lt;/p&gt;
&lt;p&gt;As i am sitting here writng in this void space at 1:42:14 am, I think to myslef&amp;hellip;wait im drifiting away again..nope. There are lot of distractions during the day time. Sometimes I get the best ideas and solve problems only during the night.. but why.. its not like I can note mute the nose during daytime, I have anc headphones, piano/guitar music, osts, game ost, and etc.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;//bluepie.in/images/posts/birthday-month-and-reflection/post-from-august-2020.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;And the above text is from 2020, oh how naive I can be at times? Though I made some progress to contribute to opensource and also progressed in excelling in a new domain. but professionally, I moved to a new company and there I started working in java. Which is not the new domain I told I would pursue. Though for open source I am maintaining some apps for android.&lt;/p&gt;
&lt;h2 id=&#34;what-am-i-gona-do-this-year&#34;&gt;What am I gona do this year?&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;In terms of Health&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;During the covid period and after, I became unfit, this i realized after during the tavesl between chennain and hometown, I would feel uneasy flexing hy body and I had no stamina, and when I compared photos, it became obvious.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;//bluepie.in/images/posts/birthday-month-and-reflection/august-post-2023-taken-2020.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;pic from 2021, during my old office&amp;rsquo;s tour - (though I look skinny (lost muscle mass after going to Chennai), I am perfectly healthy) after this I gained weight, developed love-handles which is hardest to lose, as I an writing, drafting this.. I&amp;rsquo;ve already started to workout more, the goal here is to build my old stamina and going back to gym.. yea..back. I used to go to gym on college, at that time I gained weight then when i moved to chennai, lost weight, then when I got back to home during covid, gained a lot of weight..&lt;/p&gt;
&lt;p&gt;below is the pic of me from 2023 thought I kinda don&amp;rsquo;t look unhealthy, I am unhealthy here, the shirt is covering my belly and love-handles.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;//bluepie.in/images/posts/birthday-month-and-reflection/august-post-2023-taken-2023.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;For this year, my goal is to become fit, already on a xx+ day streak at the time of writing this.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;In terms of Job&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;So here is my goal, I wana move to an even better comapany and expand my knowledge or work here at current compay (vz at the time of writing this) but go to higher designation (SDE II to higher) or even better like my friend who is working remote, find a job that has full time remote. ~review it next year..okey?&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;In terms of Open Source&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;With an office job, social life,..nd all the other distractions.. living at the work location.. its difficult for me to maintain a steady contribution to opensource.. I always think about it, but have somthing that has more priority than this. I guess for the coming year too, it will be the same? idk..lets hope for the best!&lt;/p&gt;
&lt;h2 id=&#34;additionaly-notes&#34;&gt;Additionaly notes&lt;/h2&gt;
&lt;p&gt;Removed a lot of stuff after reviewing it a couple of times..but some are encrypted, this was in a draft for a long time now.&lt;/p&gt;</description></item><item><title>Android CI on Github</title><link>//bluepie.in/2023/03/android-ci/</link><pubDate>Sun, 12 Mar 2023 00:08:06 +0000</pubDate><guid>//bluepie.in/2023/03/android-ci/</guid><description>
&lt;p&gt;Been busy, its not like I lost interest in posting here, I just didn&amp;rsquo;t allocate time for writing here, which is the opposite of what I set out to do.. which in turn does not track my progress at all, I should be held accountable for my progress. ~pff I hate it.&lt;/p&gt;
&lt;p&gt;A friend told me in the time that I did not post, not necessarily everything should be a progress, maybe this is right or maybe wrong..only time will tell. (Meaning sometimes you can just relax, but to be honest.. I was not releaxing aswell)&lt;/p&gt;
&lt;h2 id=&#34;why-about&#34;&gt;Why &amp;amp; About&lt;/h2&gt;
&lt;p&gt;This is going to short, Recently I created a CI for development android builds, this is to reduce &amp;amp; eliminate the manuall build process to every pr, this reduces a lot of time for me.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;so what does this do?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;When a Pull Request is made to &lt;code&gt;development&lt;/code&gt; or &lt;code&gt;master&lt;/code&gt; branch, a CI will trigger that will pull all the latest code from that branch and try to build the code in &lt;code&gt;dev&lt;/code&gt; mode, it will report whether tests and build is success and export the final apk. This will be helpful for testers and even me to take the build right away and check whether the code breaks the build or not. Additionally I dont have to manually make a comment everytime for testers to take the build.&lt;/p&gt;
&lt;h2 id=&#34;android-ci-with-github-actions&#34;&gt;Android CI with github actions&lt;/h2&gt;
&lt;p&gt;GitHub Actions is a continuous integration and continuous delivery (CI/CD) platform that allows to automate builds, test, and deployment pipeline. We can create workflows that build and test every pull request to our repositories.&lt;/p&gt;
&lt;h3 id=&#34;github-actions-free-tier&#34;&gt;Github actions free tier&lt;/h3&gt;
&lt;p&gt;GitHub Actions are unlimited for public repositories and the Free plan also provides 2,000 minutes of Actions each month for use with out private projects.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;//bluepie.in/images/posts/android-ci/github-free-account.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;//bluepie.in/images/posts/android-ci/actions-for-private-reporsitories.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
&lt;h3 id=&#34;gradle-build&#34;&gt;Gradle build&lt;/h3&gt;
&lt;p&gt;There are different variants of your application (release &amp;amp; debug, each variant has its own set of porperties). But what do we need here? debug variant, because that is what we share with the users and get feedback from. I mainly wanted this because everytime I make a pull request, I have to check if it builds, take builds.. I then have to link the builds to that pull request, so others/ even I can use it and test that pull request.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Commands&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;debug: This is the specific variant of the application that is being built. In Android projects, you can define different build variants, such as debug and release, to configure different settings and behavior. The debug variant is typically used during development and testing, while the release variant is used for production-ready builds. (note that: for the debug build the sizes will be significantly big than release builds)&lt;/p&gt;
&lt;p&gt;For example: &lt;a href=&#34;https://github.com/aghontpi/ad-silence/blob/51fb5782f711388c6632fa2d762b4beded3c9320/app/build.gradle#L19-L33&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;In my case I have these two builds&lt;/a&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-gradle&#34;&gt;buildTypes {
release {
minifyEnabled true
shrinkResources true
proguardFiles getDefaultProguardFile(&#39;proguard-android-optimize.txt&#39;), &#39;proguard-rules.pro&#39;
}
debug {
minifyEnabled true
shrinkResources true
proguardFiles getDefaultProguardFile(&#39;proguard-android-optimize.txt&#39;), &#39;proguard-rules.pro&#39;
}
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I just specifically need the debug build alone.&lt;/p&gt;
&lt;h2 id=&#34;what-is-a-keystore-why-do-we-need-it&#34;&gt;What is a Keystore &amp;amp; Why do we need it?&lt;/h2&gt;
&lt;p&gt;A keystore plays a pivotal role in ensuring the security and integrity of our application. Essentially, a keystore is a secure store that holds cryptographic keys, certificates, and sensitive data used to digitally sign our App. These keys are used to digitally sign our App&amp;rsquo;s APK file. This digital signature serves as a means to verify the authenticity and origin of your application. When a user installs an app, the Android system uses the keystore&amp;rsquo;s digital signature to confirm that the App has not been tampered with and that it indeed originates from the expected source. This prevents malicious actors from altering the app&amp;rsquo;s code and introducing potential security vulnerabilities.&lt;/p&gt;
&lt;p&gt;To simply put, we need this to distribute our app builds, users can trust this build since it is from us.&lt;/p&gt;
&lt;p&gt;This keystore file should be kept private, should not be shared with others and can not be comitted along with other files in the repository.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;If we keep this file private, how do we take builds then?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;This is where &lt;a href=&#34;https://docs.github.com/en/actions/security-guides/encrypted-secrets&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;configuring secret in github actions&lt;/a&gt; comes into play.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;//bluepie.in/images/posts/android-ci/configuring-secret-github-actions.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Once the secrets are configured, it can be used like below&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;- name: Decode keystore
env:
DEBUG_KEYSTORE: ${{ secrets.DEBUG_KEYSTORE }}
run: |
echo &amp;quot;$DEBUG_KEYSTORE&amp;quot; | base64 --decode &amp;gt; debug.keystore
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;configuring-the-workflow&#34;&gt;Configuring the workflow&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;We set a name &amp;amp; when should the builds be triggered, it can be of several things Cron, Issue Comment, Pull Request, Fork, Deployment Status..etc. See the &lt;a href=&#34;https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows.&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;full list here&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;For my usecase, what I specifically need here is &lt;a href=&#34;https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#push&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;push&lt;/a&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;name: Android CI
on:
push:
branches: [ &amp;quot;master&amp;quot;, &amp;quot;development&amp;quot; ]
pull_request:
branches: [ &amp;quot;master&amp;quot;, &amp;quot;development&amp;quot; ]
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Then we need to &lt;a href=&#34;https://docs.github.com/en/actions/using-jobs/using-jobs-in-a-workflow&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;specify the jobs&lt;/a&gt;, there can be multiple job, but in our case, we just need a build job, give it a name.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;jobs:
build:
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Choosing &lt;a href=&#34;https://docs.github.com/en/actions/using-jobs/choosing-the-runner-for-a-job&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;which type of machine&lt;/a&gt; this should be run on.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;runs-on: ubuntu-latest
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;A job contians sequence of tasks called &lt;a href=&#34;https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions#jobsjob_idsteps&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;steps&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Checking out&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;- name: checkout &amp;amp; set up JDK 11
- uses: actions/checkout@v3
uses: actions/setup-java@v3
with:
java-version: &#39;11&#39;
distribution: &#39;temurin&#39;
cache: gradle
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;Decode keystore from repository secrets&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;- name: Decode keystore
env:
DEBUG_KEYSTORE: ${{ secrets.DEBUG_KEYSTORE }}
run: |
echo &amp;quot;$DEBUG_KEYSTORE&amp;quot; | base64 --decode &amp;gt; debug.keystore
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;Make gradle executable &amp;amp; run gradle build&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;- name: Grant execute permission for gradlew
run: chmod +x gradlew
- name: Build with Gradle
env:
KEYSTORE_PASSWORD: ${{ secrets.KEYSTORE_PASSWORD }}
KEY_ALIAS: ${{ secrets.KEYSTORE_ALIAS }}
KEY_PASSWORD: ${{ secrets.KEY_PASSWORD }}
run: ./gradlew assembleDebug -Pandroid.injected.signing.store.file=$(pwd)/debug.keystore -Pandroid.injected.signing.store.password=$KEYSTORE_PASSWORD -Pandroid.injected.signing.key.alias=$KEY_ALIAS -Pandroid.injected.signing.key.password=$KEY_PASSWORD
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;We inject the &lt;code&gt;debug.keystore&lt;/code&gt; &amp;amp; other environment variables into the build using params like &lt;code&gt;-Pandroid.injected.signing.store.file=$(pwd)/debug.keystore&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Upload the artifacts&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;- name: Upload debug build
uses: actions/upload-artifact@v3
with:
name: &amp;lt;upload-name&amp;gt;.apk (build artifact)
path: app/build/outputs/apk/debug/app-debug.apk
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/aghontpi/ad-silence/blob/master/.github/workflows/android.yml&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;Full workflow file.&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Build in action&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;//bluepie.in/images/posts/android-ci/build-in-action.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
&lt;h2 id=&#34;conclusion&#34;&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;This enabled me to not care about dev-debug builds entirely and focus just on development, which is a great time save.&lt;/p&gt;
&lt;p&gt;In future, I would create a separate releases named &lt;code&gt;nightly&lt;/code&gt;, where the dev branch is built daily and these builds will be updated there.&lt;/p&gt;</description></item><item><title>Updating Dns Servers for Ads and Tracking Protection in 2023</title><link>//bluepie.in/2023/01/updating-dns-servers-for-ads-and-tracking-protection-in-2023/</link><pubDate>Sat, 28 Jan 2023 06:02:22 +0000</pubDate><guid>//bluepie.in/2023/01/updating-dns-servers-for-ads-and-tracking-protection-in-2023/</guid><description>
&lt;h2 id=&#34;upgrading-pi-hole&#34;&gt;Upgrading PI hole&lt;/h2&gt;
&lt;p&gt;Once every year, I do server maintainence (during Dec-Jan), this year I updated the our dns server from &lt;a href=&#34;https://github.com/pi-hole/pi-hole&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;pi-hole&lt;/a&gt; to &lt;a href=&#34;https://github.com/AdguardTeam/AdGuardHome&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;AGH&lt;/a&gt; (both are open source projects..) Just wanted to try an alternative, after using it for a while, the UI &amp;amp; Features on AGH is much better than pi-hole.&lt;/p&gt;
&lt;h2 id=&#34;why-a-custom-dns-server&#34;&gt;Why a custom dns server?&lt;/h2&gt;
&lt;p&gt;All websites/apis are just ip addresses (just numbers). Nameservers maintains a mapping of the domain names to the ip addresses, so when we make a request, we get the appropriate ip address.&lt;/p&gt;
&lt;p&gt;The idea is simple, by running our own dns server, we can prevent our network providers spying on us, on top of that we can intercept &amp;amp; block all ads &amp;amp; trackers.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;I get ads, but what are Trackers?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Similar to ads, ever been in a situation where you searched for something in flipkart/amazon.. then later you find the ad to buy the product elsewhere, this is because of trackers.. trackers are worse because they collect your data, the same way we block ads, trackers should be blocked.&lt;/p&gt;
&lt;h2 id=&#34;how-this-can-help-us-with-ad-trackers-blocking&#34;&gt;How this can help us with ad &amp;amp; trackers blocking?&lt;/h2&gt;
&lt;p&gt;Can you make a guess how serving ads in app/websites work? they are from a server too, that server has a domain linked to it.. can you see where I am are going with this?&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-text&#34;&gt;good content -&amp;gt; respond with ip address
ad/tracker -&amp;gt; respond with 0.0.0.0
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Not just blocking ads &amp;amp; tracking, you can do much more.. there are other things that you can do in dns level.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;block windows tracking or updates in windows machines&lt;/li&gt;
&lt;li&gt;blocking spyware&lt;/li&gt;
&lt;li&gt;disabling websites for a particular client (ex: blocking instagram on a your phone alone)&lt;/li&gt;
&lt;li&gt;if you don&amp;rsquo;t want to keep tracking of your watch history in youtube
and many more.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;aren-t-there-other-solutions-to-blocking-trackers-and-ads&#34;&gt;Aren&amp;rsquo;t there other solutions to blocking trackers and ads?&lt;/h3&gt;
&lt;p&gt;yes but those come with a disadvantage,&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Browser extensions.. only applies to browsers (system wide, everywhere and all applications)&lt;/li&gt;
&lt;li&gt;Android, Iphone (separate apps that use vpn locally to achieve this) - Drains battery alot&lt;/li&gt;
&lt;li&gt;Rooting android, Jailbreaking ios.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;so this does not require any of that.. no addons, no extra apps, no root, no jailbreak.&lt;/p&gt;
&lt;h2 id=&#34;dns-over-tls&#34;&gt;DNS Over TLS&lt;/h2&gt;
&lt;p&gt;Introduced in 2016, main idea is wrapping DNS requests and responses via TLS (Transport Layer Security), ensures observer will not be able to track or tamper the contents of the DNS requests.&lt;/p&gt;
&lt;!-- ssl - secure socket layer --&gt;
&lt;!-- tls - tranport layer security, offers end to end security. --&gt;
&lt;p&gt;Shortly after, android introduced DOT as &amp;ldquo;Private DNS&amp;rdquo; on Android 9 &amp;amp; up, we will be using this feature in our devices to block all ADS &amp;amp; Trackers.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;//bluepie.in/images/posts/block-ads-and-tracking-upgradging-dns-server/DOT-noMITM.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;client -&amp;gt; dot server, dot server -&amp;gt; queries the dns.. (we forward our request to serveral dns servers, load-balancers)&lt;/p&gt;
&lt;p&gt;Traditional DNS vs DOT&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;//bluepie.in/images/posts/block-ads-and-tracking-upgradging-dns-server/traditional-vs-dot.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
&lt;h2 id=&#34;how-do-we-do-it&#34;&gt;How do we do it?&lt;/h2&gt;
&lt;p&gt;We use an existing open source dns resolver.&lt;/p&gt;
&lt;p&gt;One options is to go with &lt;a href=&#34;https://github.com/pi-hole/pi-hole&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;PI Hole&lt;/a&gt;, it is a community favourite open source project that has all the bells and whistles for blocking ads and trackers integrated inside it.&lt;/p&gt;
&lt;p&gt;We will be using &lt;a href=&#34;https://github.com/AdguardTeam/AdGuardHome&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;AG Home&lt;/a&gt;, it is also a popular open source project, which is community maintained. up until lastmonth (dec 2022) I was using PI-hole, switched to AG-Home, just to try something new.&lt;/p&gt;
&lt;h3 id=&#34;installing&#34;&gt;Installing&lt;/h3&gt;
&lt;p&gt;I am assuming that you already have a linux box hosted in aws/google/..etc. DOT works on port 853, so you have to allow incoming and outgoing traffic in port 853.&lt;/p&gt;
&lt;h4 id=&#34;docker&#34;&gt;Docker&lt;/h4&gt;
&lt;p&gt;To make things easier, I will be using docker images to run the software.&lt;/p&gt;
&lt;p&gt;running a docker container.. command&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-sh&#34;&gt;
podman run --name dnsServer\
--restart unless-stopped\
-p 2346:3000/tcp\
-p 1853:853/tcp\
-d adguard/adguardhome
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Things to note are, exposed port 3000 is the webport for admin page &amp;amp; 853 is for DOT.&lt;/p&gt;
&lt;p&gt;We maintain the configs in a yaml file which will be mounted to the container.. here is an example version.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;bind_host: 0.0.0.0
bind_port: 3000
beta_bind_port: 0
users:
# - name: &amp;lt;your-username&amp;gt;
# password: &amp;lt;your-passowrd&amp;gt;
auth_attempts: 5
block_auth_min: 15
http_proxy: &amp;quot;&amp;quot;
language: &amp;quot;&amp;quot;
theme: auto
debug_pprof: false
web_session_ttl: 720
dns:
bind_hosts:
- 0.0.0.0
blocked_response_ttl: 10
ratelimit: 20
refuse_any: true
fastest_timeout: 1s
tls:
enabled: true
server_name: dns.bluepie.in
port_https: 443
port_dns_over_tls: 853
certificate_path: /opt/dnsServer/conf/fullchain.pem
private_key_path: /opt/dnsServer/conf/privkey.pem
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Once everything is configured correctly, the service will be up and running.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;podman ps
b831cf04743d docker.io/adguard/adguardhome:latest --no-check-update... 1 days ago Up 3 weeks ago 0.0.0.0:1853-&amp;gt;853/tcp, 0.0.0.0:2346-&amp;gt;3000/tcp dnsServer
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;configuring-domain&#34;&gt;Configuring Domain&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;First we need a domain name, a paid one if you have it or a free one would be good, I&amp;rsquo;ll be creating a sub-domain from my domain, (i.e) &amp;lsquo;dns.bluepie.in&amp;rsquo; and get SSL certificates chain for the same.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Inorder to uniquely identify clients, we need to create a wildcard sud-domain in our DNS provider, in my case godaddy.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;//bluepie.in/images/posts/block-ads-and-tracking-upgradging-dns-server/creating-wild-card-dns.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
&lt;h4 id=&#34;nginx&#34;&gt;Nginx&lt;/h4&gt;
&lt;p&gt;We will be using nginx as a reverse proxy for exposing our services to the internet.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Admin Config:&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-conf&#34;&gt; server_name dns.bluepie.in;
location / {
proxy_pass http://localhost:2346/;
proxy_set_header Upgrade $http_upgrade;
proxy_set_header Host $host;
proxy_set_header X-Real-IP $remote_addr;
proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
proxy_set_header X-Forwarded-Proto $scheme;
proxy_set_header X-Forwarded-Host $host;
proxy_redirect / / ;
proxy_cookie_path / /;
proxy_connect_timeout 15s;
proxy_send_timeout 15s;
proxy_read_timeout 15s;
}
listen 443 ssl;
ssl_certificate /path/to/fullchain.pem;
ssl_certificate_key /path/to/privkey.pem;
include /etc/ssl/options-ssl-nginx.conf;
ssl_dhparam /etc/ssl/ssl-dhparams.pem;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;DNS Config:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;nginx has a load balancing feature, stream directive to manage tcp and udp. we can use this to forward our requests to dns servers.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-conf&#34;&gt;stream {
log_format basic &#39;$time_iso8601 $remote_addr &#39;
&#39;$protocol $status $bytes_sent $bytes_received &#39;
&#39;$session_time $upstream_addr &#39;
&#39;&amp;quot;$upstream_bytes_sent&amp;quot; &amp;quot;$upstream_bytes_received&amp;quot; &amp;quot;$upstream_connect_time&amp;quot;&#39;;
access_log /var/log/nginx/dns-access.log basic buffer=1k flush=5s;
upstream dot {
zone dot 512k;
server 127.0.0.1:1853;
}
server {
listen 853;
proxy_pass dot;
}
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;admin-portal&#34;&gt;Admin portal&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;Stats page (configured to refresh every 24 hours)&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;//bluepie.in/images/posts/block-ads-and-tracking-upgradging-dns-server/dns-statistics.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Configuring blocklists&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Over the years, I have accustomed to the following blocklists and it works best for me.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;//bluepie.in/images/posts/block-ads-and-tracking-upgradging-dns-server/dns-blocklists.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Blocklists (entires count taken at the time of writing this post&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-text&#34;&gt;# Blocks Ads, Mobile Ads, Phishing, Malvertising, Malware, Tracking, Telemetry, CryptoJacking, Analytics, Spyware, Ransomware, Exploit, Fraud, Abuse, Scam, Spam, Hijack, Misleading Marketing.
# ~300,000 entries
https://oisd.nl
# ~180,000 entries
# Extending and consolidating hosts files from several well-curated sources like adaway.org, mvps.org, malwaredomainlist.com, someonewhocares.org, and potentially others.
github.com/StevenBlack/hosts
# ~480,000 entries
# Automatically updated, moderated and optimized list for blocking ads, trackers and other online garbage.
github.com/notracking/hosts-blocklists
# Specially Designed for Mobile Ad Protection.
# ~200,000 entries
github.com/jerryn70/GoodbyeAds
# Blocking mobile ad providers and some analytics providers.
# ~7,000 entries
github.com/AdAway/adaway.github.io
# A filter composed of several other filters (AdGuard Base filter, Social media filter, Tracking Protection filter, Mobile Ads filter, EasyList and EasyPrivacy) and simplified specifically to be better compatible with DNS-level ad blocking.
# ~50,000 entries
github.com/AdguardTeam/AdguardSDNSFilter
# Protects you from many types of spyware, reduces bandwidth use, blocks certain pop-up traps, prevents user tracking by way of &amp;quot;web bugs&amp;quot; embedded in spam, provides partial protection to IE from certain web-based exploits and blocks most advertising you would otherwise be subjected to on the internet.
# ~11,000 entries
someonewhocares.org/hosts
# Filter that blocks ads on mobile devices. Contains all known mobile ad networks.
# ~1,000 entries
kb.adguard.com/general/adguard-ad-filters#mobile-ads-filter
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;how-do-we-use-it&#34;&gt;How do we use it?&lt;/h2&gt;
&lt;p&gt;Pick a unique word, ex: gopidevice1, then use this word as prefix for &amp;lsquo;dns.bluepie.in&amp;rsquo;. (i.e) &amp;lsquo;gopidevice1.dns.bluepie.in&amp;rsquo;, this is the url that you should use in your devices.&lt;/p&gt;
&lt;h3 id=&#34;android&#34;&gt;Android&lt;/h3&gt;
&lt;p&gt;&lt;img src=&#34;//bluepie.in/images/posts/block-ads-and-tracking-upgradging-dns-server/android-config.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
&lt;h3 id=&#34;ios-iphone-ipad&#34;&gt;IOS - iphone, ipad&lt;/h3&gt;
&lt;p&gt;Go to &lt;a href=&#34;https://dns.bluepie.in/ios/&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;dns.bluepie.in/ios/&lt;/a&gt;, navigate to &amp;lsquo;tool&amp;rsquo;, give a name and use your unique url to create a profile.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;//bluepie.in/images/posts/block-ads-and-tracking-upgradging-dns-server/ios-config-1.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;//bluepie.in/images/posts/block-ads-and-tracking-upgradging-dns-server/ios-config-2.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
&lt;h3 id=&#34;mac-windows&#34;&gt;Mac/Windows&lt;/h3&gt;
&lt;p&gt;Same as iphone, go to &lt;a href=&#34;https://dns.bluepie.in/ios/&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;dns.bluepie.in/ios/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;//bluepie.in/images/posts/block-ads-and-tracking-upgradging-dns-server/dot-install-macos-3.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
&lt;h2 id=&#34;conclusion&#34;&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;Migrating from PI-Hole to AGH was a good move, once you have used this and experienced &amp;ldquo;no ads&amp;rdquo;, you can not go back~&lt;/p&gt;</description></item><item><title>Modding a macOS App</title><link>//bluepie.in/2022/02/modding-a-macos-app/</link><pubDate>Sun, 20 Feb 2022 19:10:13 +0000</pubDate><guid>//bluepie.in/2022/02/modding-a-macos-app/</guid><description>
&lt;h2 id=&#34;intro&#34;&gt;Intro&lt;/h2&gt;
&lt;p&gt;This post is about reversing.. but for a MACOS binary. Lets drive straight into it.&lt;/p&gt;
&lt;p&gt;Modding in macOS is fairly new to me, but a binary is a binary and it can be modded!. I started to daily drive macOS a month or two ago, the why and what&amp;rsquo;s is a whole different story to post about.&lt;/p&gt;
&lt;p&gt;Like I have said previously in my other &lt;a href=&#34;https://bluepie.in/categories/reversing/&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;re posts&lt;/a&gt;, &amp;ldquo; I don&amp;rsquo;t trust mods from the internet&amp;rdquo; If I can mod it then its fine, otherwise I&amp;rsquo;m paying for it.&lt;/p&gt;
&lt;p&gt;I just started to understand the quirks of &amp;ldquo;OS X&amp;rdquo;, Though some of my methods may be crude&amp;hellip;it works, I will perfect them..&lt;/p&gt;
&lt;h2 id=&#34;target&#34;&gt;Target&lt;/h2&gt;
&lt;p&gt;So there is this great app for cleaning your Mac&amp;rsquo;s junk/storage files, but the free version only lets you clean 500mb daily.. the premium version is a whooping 3k per year&amp;hellip;do you get where I am going with this ? &amp;hellip;YES!&amp;hellip;modding for fun and profit (PROFIT = personal use)&lt;/p&gt;
&lt;h2 id=&#34;tools&#34;&gt;Tools&lt;/h2&gt;
&lt;p&gt;So I&amp;rsquo;m gonna be trying out ghidra &amp;ldquo; The NSA&amp;rsquo;s reverse engineering tool &amp;ldquo;, mainly because Its a open source tool and I wanted to do some reverse engineering with it for a long time now.&lt;/p&gt;
&lt;p&gt;make sure you have &lt;a href=&#34;https://brew.sh/&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;brew&lt;/a&gt; installed and then run the following command&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-console&#34;&gt;brew install --cask ghidra
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;making-observation-to-the-target&#34;&gt;Making observation to the target&lt;/h2&gt;
&lt;p&gt;The app throws you with the &amp;ldquo;Nag Screen&amp;rdquo; whenever you use the app, it blocks the usage of features (can not use the app to remove more than 500MB of data,privacy scanning won&amp;rsquo;t work unless you pay,..etc).&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;500mb storage limit reached &amp;lsquo;nag screen&amp;rsquo;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;//bluepie.in/images/posts/modding-a-macos-app/500mb-over-nag-screen.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Trial period expired &amp;lsquo;nag screen&amp;rsquo;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;//bluepie.in/images/posts/modding-a-macos-app/clean-my-mac-unmodded.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
&lt;h2 id=&#34;basics-understanding-ghidra&#34;&gt;Basics &amp;amp; Understanding Ghidra&lt;/h2&gt;
&lt;p&gt;All macOS apps have the following structure, the main binary will always be inside the MacOS directory.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;//bluepie.in/images/posts/modding-a-macos-app/mac-app-folder-structure.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Launch Ghidra and create a new project, then drag and drop the binary into the project.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;//bluepie.in/images/posts/modding-a-macos-app/create-new-project.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Mac has this binary format &amp;ldquo;macobinary&amp;rdquo; - basically it contains the different target executables, ex: (arm binary vs the x86 binary).. mine is a x86 machine, will be modding that alone.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;//bluepie.in/images/posts/modding-a-macos-app/choose-appropriate-target-binary.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;After the import, Ghidra will automatically ask you to analyse the target binary, choose Analyse. (it will make our life easier), based on the binary size and your cpu cores, it may take couple minutes.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;//bluepie.in/images/posts/modding-a-macos-app/will-ask-for-analyse-choose-analyse.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Only focus on the following five windows, that is enough to get the job done.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;//bluepie.in/images/posts/modding-a-macos-app/ghidra-ui.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;1 = will contain the symbol tabel, this is where we do most of the filtering.&lt;/li&gt;
&lt;li&gt;2 = shows the disassembly of the binary (assembly language), this is where we do the actual reversing, (i.e) patching, understanding logic, etc.&lt;/li&gt;
&lt;li&gt;3 = This is a great feature, shows the equivalent c code, to the selected assembly section.&lt;/li&gt;
&lt;li&gt;4 &amp;amp; 5 = shows the incoming and outgoing function calls, this will help us find interesting things about the binary, which then can be used for identifying logic and patching.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;IF ANY OF THE ABOVE WINDOWS ARE NOT OPEN, YOU CAN ENABLE THEM THROUGH THE MENU OPTION &amp;ldquo;WINDOW&amp;rdquo;.&lt;/p&gt;
&lt;h2 id=&#34;analysis&#34;&gt;Analysis&lt;/h2&gt;
&lt;p&gt;It will take some time to find what you are looking for, but I have already invested time in this, so what we need is &amp;ldquo;activationManager&amp;rdquo; class, it has all sorts of interesting functions like &amp;ldquo;activationStatus, isAppActivated..etc&amp;rdquo;. Looking for references, it is used throughout the app, so lets change it.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;//bluepie.in/images/posts/modding-a-macos-app/different-app-status.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Looking around, we find the different status codes inside &amp;ldquo;activationStatus&amp;rdquo;.&lt;/p&gt;
&lt;p&gt;By checking other functions, it becomes obvious that, changing only &amp;ldquo;isAppActivated&amp;rdquo; function is enough. The return type of the function is &amp;ldquo;char&amp;rdquo;, with reference to &amp;ldquo;status&amp;rdquo; from above..we should return &amp;ldquo;3&amp;rdquo;. From the ascii table, &amp;ldquo;0x33&amp;rdquo; is the equivalnet for &amp;ldquo;3&amp;rdquo;.&lt;/p&gt;
&lt;p&gt;Patching the &amp;ldquo;isAppActivated&amp;rdquo; function, with the following code.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;push rbp
mov rbp,rsp
mov DWORD PTR [rbp-0x4],0x0
mov eax,0x33
pop rbp
ret
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;then export the program &amp;ldquo;File -&amp;gt; Export Program&amp;rdquo;, our patched binary is ready. Now give executable permission and move it to the original directory.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;//bluepie.in/images/posts/modding-a-macos-app/move-exported-binary-to-original-directory.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;rename the original&lt;/p&gt;
&lt;h2 id=&#34;signing-running-the-modded-binary-for-profit&#34;&gt;Signing &amp;amp; Running the modded binary for PROFIT&lt;/h2&gt;
&lt;p&gt;Unlike windows and linux, macOS won&amp;rsquo;t run applications without signing the binary.. but we can generate your own certificates for personal use (dont have to buy a developer account for 99$/year).&lt;/p&gt;
&lt;p&gt;create a certificate using &amp;ldquo;keychain Access&amp;rdquo;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;//bluepie.in/images/posts/modding-a-macos-app/create-custom-certifcate.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;choose &amp;ldquo;code signing&amp;rdquo; in &amp;ldquo;certificate type&amp;rdquo;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;//bluepie.in/images/posts/modding-a-macos-app/choose-code-signing.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Go to the application root &amp;ldquo;/Application/&amp;rdquo; to resign the entire app.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;sudo codesign -s &amp;quot;&amp;lt;name-of-certificate&amp;gt;&amp;quot; -fv CleanMyMac-MAS.app/
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Run the app&amp;hellip; Now its been modded and I don&amp;rsquo;t have to pay 3k INR a year or worry about untrusted binaries from the internet.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;//bluepie.in/images/posts/modding-a-macos-app/removed-files-beyong-the-limit.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;You can see from the image, all the premium features are now unlocked &amp;amp; we can also remove the junk files exceeding 500MB.&lt;/p&gt;
&lt;h2 id=&#34;end&#34;&gt;End&lt;/h2&gt;
&lt;p&gt;This was a fun excerise to dig around. Macos is not that limited as I thought it was&amp;hellip; Sure it has its quirks.&lt;/p&gt;</description></item><item><title>&#34;F-droid&#34; vs the pain that is &#34;Google PlayStore&#34;</title><link>//bluepie.in/2022/01/publishing-to-fdroid-google-play/</link><pubDate>Wed, 05 Jan 2022 21:34:18 +0530</pubDate><guid>//bluepie.in/2022/01/publishing-to-fdroid-google-play/</guid><description>
&lt;p&gt;&lt;strong&gt;How you doing? hope you are doing well. I missed to post on december because I was juggling too much things at once and needed a break&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&#34;fdroid&#34;&gt;Fdroid?&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;https://fdroid.org&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;Fdroid&lt;/a&gt; is a free and open source Android application repository. You can use Fdroid via the &lt;a href=&#34;https://f-droid.org/client&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;F-Droid client&lt;/a&gt; or the &lt;a href=&#34;https://f-droid.org/&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;F-Droid website&lt;/a&gt;. It is similar to the &lt;a href=&#34;https://play.google.com/store&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;Google Play Store&lt;/a&gt;, but with a few key differences:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;is free and open source&lt;/li&gt;
&lt;li&gt;contains only open source applications&lt;/li&gt;
&lt;li&gt;is not a commercial service&lt;/li&gt;
&lt;li&gt;all google play dependencies are stripped out when publishing&lt;/li&gt;
&lt;li&gt;goes through a series of automated tests &amp;amp; manual reviews before being accepted&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;//bluepie.in/images/posts/publishing-to-fdroid-and-playstore/fdroid.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
&lt;h3 id=&#34;how-do-i-add-a-new-app-to-fdroid&#34;&gt;How do I add a new app to Fdroid?&lt;/h3&gt;
&lt;p&gt;There are two options, choose one:&lt;/p&gt;
&lt;p&gt;If you don&amp;rsquo;t want to do it yourself&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;You create a issue in &lt;a href=&#34;https://gitlab.com/fdroid/rfp/-/issues&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;REP - Request For Packaging&lt;/a&gt; and the contributors will review your request and add it to the repository.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;//bluepie.in/images/posts/publishing-to-fdroid-and-playstore/rep.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;If you want to do it yourself&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Open a issue on &lt;a href=&#34;https://gitlab.com/fdroid/fdroiddata/-/merge_requests&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;Fdroid data&lt;/a&gt; with the appropriate yaml(metadata) file, you should create one with your metadata, refer &lt;a href=&#34;https://f-droid.org/docs/FAQ_-_App_Developers/#how-do-i-get-my-app-included&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;this&lt;/a&gt;, &lt;a href=&#34;https://f-droid.org/docs/Submitting_to_F-Droid_Quick_Start_Guide/&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;this link&lt;/a&gt; &amp;amp; &lt;a href=&#34;https://gitlab.com/fdroid/fdroiddata/blob/master/CONTRIBUTING.md#merge-requests&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;this&lt;/a&gt; for more information.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;After being reviewed and added to the repository, it will avialable for everyone to download and install.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;//bluepie.in/images/posts/publishing-to-fdroid-and-playstore/fdroid-data.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;here is a basic example of the metadata yaml file:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;Categories:
License:
AuthorName:
AuthorEmail:
AuthorWebSite:
WebSite:
SourceCode:
IssueTracker:
Changelog:
...etc
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;View the full file &lt;a href=&#34;https://gitlab.com/fdroid/wiki/-/wikis/Metadata/YAML-Metadata&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;here&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;how-do-i-publish-updates-to-fdroid&#34;&gt;How do I publish updates to Fdroid?&lt;/h3&gt;
&lt;p&gt;The great thing about Fdroid is that it automatically detects new versions of your app from github and updates it there. So you just have to make a new tag in your repo and fdroid will handle the rest.&lt;/p&gt;
&lt;h3 id=&#34;how-did-i-publish-to-fdroid&#34;&gt;How did I publish to Fdroid?&lt;/h3&gt;
&lt;p&gt;I went through &amp;ldquo;do it yourself&amp;rdquo; and &lt;a href=&#34;https://gitlab.com/fdroid/fdroiddata/-/merge_requests/10097&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;this is the pull request&lt;/a&gt; that I created.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;AntiFeatures:
- NonFreeAdd
Categories:
- System
License: GPL-3.0-only
AuthorName: BluePie
...etc
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;View the full file is &lt;a href=&#34;https://gitlab.com/bluepie/fdroiddata/-/raw/09cc09572b0352a07b84a01a9d21ae5f4c4a1bc3/metadata/bluepie.ad_silence.yml&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;here&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;google-play-store&#34;&gt;Google Play Store?&lt;/h2&gt;
&lt;p&gt;Goople PlayStore needs no explanation. It is a commercial service that is used by millions of users to download and install apps. It is a great way to monetize &amp;amp; distribute your apps. You need to buy a license with a one time fee though.&lt;/p&gt;
&lt;p&gt;Anyway lets get started&amp;hellip;&lt;/p&gt;
&lt;h3 id=&#34;how-do-i-publish-update-to-google-play-store&#34;&gt;How do I publish/Update to Google Play Store?&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;First you create a new app,&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;//bluepie.in/images/posts/publishing-to-fdroid-and-playstore/create-new-app.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Complete all the tasks in the Dashboard&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;//bluepie.in/images/posts/publishing-to-fdroid-and-playstore/complete-tasks-in-console-dashboard.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Generate privacy policy(&lt;a href=&#34;https://app-privacy-policy-generator.firebaseapp.com&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;i recommend this&lt;/a&gt;) and host it somewhere.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;//bluepie.in/images/posts/publishing-to-fdroid-and-playstore/generate-privacy-policy.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Take build bundle in android studio.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;//bluepie.in/images/posts/publishing-to-fdroid-and-playstore/generate-signed-apk-bundle.png&#34; alt=&#34;&#34; /&gt;
&lt;img src=&#34;//bluepie.in/images/posts/publishing-to-fdroid-and-playstore/generate-bundle-dialog.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Create store listing with appropriate data,&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;//bluepie.in/images/posts/publishing-to-fdroid-and-playstore/update-store-listing.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Note to upload the correct images&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;//bluepie.in/images/posts/publishing-to-fdroid-and-playstore/upload-appropriate-images.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;use the bundle from before and make a test release and promote it to production. (review process takes time)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;//bluepie.in/images/posts/publishing-to-fdroid-and-playstore/upload-bundle.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
&lt;h2 id=&#34;the-pain&#34;&gt;The pain&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;Publishing to playstore especially when the app is OpenSource is a manual time consuming process vs the automated process in Fdroid.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;There is a onetime fee for publishing to playstore.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Every release takes a week to get reviewed and published, even if it is OpenSource.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;from my experience time differs between minor, major and bug fixes (based on semantic versioning)&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;The customer support is full of bots&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Store is unfair&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;I got my app delisted because I had the word &amp;ldquo;AD&amp;rdquo; in the Icon.. eventhough there are other apps from playstore with 1m+ installs that also has the same, either way I had to change the Icon to get it back on the store.&lt;/li&gt;
&lt;li&gt;I could not get a proper response from Support &lt;a href=&#34;https://github.com/aghontpi/ad-silence/issues/19&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;more on here&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;The feedback back system is not that great, If users encounter crash/ something is not working.. In github you can have a correct feedback loop but in playstore..its just an uninstall with a lower rating.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;//bluepie.in/images/posts/publishing-to-fdroid-and-playstore/delisted.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
&lt;h2 id=&#34;end&#34;&gt;End&lt;/h2&gt;
&lt;p&gt;If you have an OpenSource App, spend less time updating it on Playstore. Stick with Github releases or Fdroid releases. Don&amp;rsquo;t even get my started on Apple app store.&lt;/p&gt;</description></item><item><title>Accuradio, Spotify...etc Adblocker in Kotlin</title><link>//bluepie.in/2021/11/accuradio-spotify-adblocker-in-kotlin/</link><pubDate>Thu, 18 Nov 2021 19:46:00 +0000</pubDate><guid>//bluepie.in/2021/11/accuradio-spotify-adblocker-in-kotlin/</guid><description>
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Hello how you been?, hope everything is going well.&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;I wanted to learn Kotlin for native Android development, I already knew how to do it with java, so the only obstacle for me is learning Kotlin.&lt;/p&gt;
&lt;h2 id=&#34;kotlin&#34;&gt;Kotlin&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Kotlin &lt;a href=&#34;https://trello.com/c/zYFtp51G/1-learn-kotlin&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;trello board&lt;/a&gt; that I used to track progress.&lt;/li&gt;
&lt;li&gt;After learning the basics for Kotlin, &lt;a href=&#34;https://play.kotlinlang.org/koans/overview&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;Kotlin koans&lt;/a&gt; is a great place for practice (beginner to advanced).&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;chosing-what-to-do-with-kotlin&#34;&gt;Chosing what to do with Kotlin&lt;/h2&gt;
&lt;p&gt;I use &lt;a href=&#34;https://accuradio.com/&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;Accuradio&lt;/a&gt; android app to stream music, but it does not have a paid tear, So the ads are not skippable and there was no existing adblocker that does this(which is a pain). So I decided to write one in Kotlin.&lt;/p&gt;
&lt;p&gt;So its decided, I am doing a project in Kotlin to block/silence ads in Accuradio, some additional things I decided to implement are the following.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;should be extensible to other apps like Spotify,&amp;hellip;etc&lt;/li&gt;
&lt;li&gt;should have minimal UI&lt;/li&gt;
&lt;li&gt;should be lightweight&lt;/li&gt;
&lt;li&gt;should be completely openSource.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;To be extensbile, I should have a common pattern/way to detect ads in these apps&amp;hellip; One such way is by using app&amp;rsquo;s notification.&lt;/p&gt;
&lt;p&gt;I can determine what an app is currenly playing using the notification, using the &lt;a href=&#34;https://developer.android.com/reference/android/app/NotificationListenerService&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;notification listener&lt;/a&gt; service and parsing the posted notifications, mute/unmute the app based on the content.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;//bluepie.in/images/posts/accuradio-spotify-ad-blocker/flow.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;An update, &lt;strong&gt;I already added support for Spotify and Tidal.&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;implementation&#34;&gt;Implementation&lt;/h2&gt;
&lt;p&gt;I pretty much have to just&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;implement the &lt;a href=&#34;https://developer.android.com/reference/android/app/NotificationListenerService&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;NotificationListenerService&lt;/a&gt; service, and parse the posted notifications,&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;extend the &lt;a href=&#34;https://developer.android.com/reference/android/app/NotificationListenerService&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;NotificationListenerService&lt;/a&gt; class and implement the &lt;a href=&#34;https://developer.android.com/reference/android/app/NotificationListenerService.OnNotificationPostedListener.html#onNotificationPosted&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;onNotificationPosted&lt;/a&gt; method &amp;amp; &lt;a href=&#34;https://developer.android.com/reference/android/app/NotificationListenerService.OnNotificationConnectedListener.html#onNotificationConnected&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;onNotificationConnected&lt;/a&gt; method.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-kt&#34;&gt;class NotificationListener : NotificationListenerService() {
override fun onListenerConnected() {
super.onListenerConnected()
appNotificationHelper?.updateNotification(&amp;quot;AdSilence, listening for ads&amp;quot;)?.run {
startForeground(NOTIFICATION_ID, this) // persistent notification
}
Log.v(TAG, &amp;quot;notification listener connected&amp;quot;)
}
override fun onNotificationPosted(sbn: StatusBarNotification?) {
super.onNotificationPosted(sbn)
}
}
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;why do I need to run it as a foreground service?&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;because In recent versions of android, any app that is actively running the background must post a notification to the status bar. Otherwise the app will be killed by the system.&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;then mute/unmute the app based on the content,&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-kt&#34;&gt;
sbn?.let {
with(AppNotification(applicationContext, it.notification, sbn.packageName)) {
Preference(applicationContext).isAppConfigured(this.getApp()).takeIf { b -&amp;gt; b }
?.run {
Utils().run {
when (NotificationParser(this@with).isAd()) {
true -&amp;gt; {
this.mute()
isMuted = true
}
false -&amp;gt; {
isMuted = false
this.unmute();
)
}
}
}
}
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;next important step is granting the app, the permission to listen to notifications. (if all apps can listen to incoming notifications, this would be a huge security flaw!)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://developer.android.com/training/permissions/requesting&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;grant permission&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;since this app is openSource, everyone can see the source code before granting permission&lt;/li&gt;
&lt;li&gt;&lt;p&gt;bascially the following one line has to be used. (note: using string to support older devices)&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-kotlin&#34;&gt;startActivity(Intent(&amp;quot;enabled_notification_listeners&amp;quot;))
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;in the android manifest, add the following to the &lt;code&gt;&amp;lt;application&amp;gt;&lt;/code&gt; tag,&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;telling the system to use the file &lt;code&gt;NotificationListenerService&lt;/code&gt; as the notification listener service.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;service android:name=&amp;quot;.NotificationListener&amp;quot;
android:label=&amp;quot;@string/notification_listener_name&amp;quot;
android:permission=&amp;quot;android.permission.BIND_NOTIFICATION_LISTENER_SERVICE&amp;quot;
android:exported=&amp;quot;false&amp;quot;&amp;gt;
&amp;lt;intent-filter&amp;gt;
&amp;lt;action android:name=&amp;quot;android.service.notification.NotificationListenerService&amp;quot; /&amp;gt;
&amp;lt;/intent-filter&amp;gt;
&amp;lt;/service&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;conclusion&#34;&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;That is all is required to get the app to work, there are other things like UI, checking app installed or not, maintaining the app running in the background, hiding the app from recents, restarting the service, preference&amp;hellip;etc. Since the app is so lightweight (around 150KB)&amp;hellip;&lt;/p&gt;
&lt;p&gt;I could write about every part of the app in this, but this app is open source&amp;hellip;.its already explained. It was so refreshing and fun work on this&amp;hellip; Kotlin is fun and I am glad to have learned it(atleast some bit).&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/aghontpi/ad-silence&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;Github/source code&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://play.google.com/store/apps/details?id=bluepie.ad_silence&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;Google play store link&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://f-droid.org/packages/bluepie.ad_silence/&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;Fdroid link&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr /&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://youtu.be/hWfiQN4IUFM&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;featured in top apps - youtube&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.nextpit.com/apps-of-the-week-48-2021&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;featured in app of the week&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description></item><item><title>Open Source Dnd Email Editor</title><link>//bluepie.in/2021/10/open-source-dnd-email-editor/</link><pubDate>Sun, 10 Oct 2021 10:48:30 +0000</pubDate><guid>//bluepie.in/2021/10/open-source-dnd-email-editor/</guid><description>
&lt;p&gt;I created a drag and drop email editor, I&amp;rsquo;ve been working on it for the past month. It&amp;rsquo;s a lot of fun to work on, I completed it for first release, I&amp;rsquo;ll shed some light on the challenges I faced and how I solved them.&lt;/p&gt;
&lt;h2 id=&#34;why-s-what-s&#34;&gt;Why&amp;rsquo;s &amp;amp; What&amp;rsquo;s&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;why build this?&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;No free editors/open source editors that does the job,&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;but why not profit?&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Not interested, I believe in Open Source. Heavily inspired by how LINUX (OPEN SOURCE) is useful for everyone now.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;the real motivation?&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Let me be frank here, I dont like &lt;em&gt;unalyer github&lt;/em&gt;, MAINLY BECAUSE OF THEIR FALSE ADVERTISEMENT AS OPEN SOURCE, I understand that&amp;rsquo;s how the get their business going but, damn its scummy.&lt;/p&gt;
&lt;p&gt;One by one respoectively&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;scumbag unlayer,&lt;/li&gt;
&lt;li&gt;grapjs mjml,
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/artf/grapesjs-mjml&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;their implementation&lt;/a&gt; was cool with mjml&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;company that I am working for, at the time of writing this, needed an email dnd editor.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;challenges&#34;&gt;Challenges&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;maintaining layer between MJML and Me.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;writing parsers, serializers and deseriealizers.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;design and code ui&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;manage drag and drop, mouse, key events, &amp;hellip;etc.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;deciding what kind of api to expose&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;deciding what inline editor to use&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;I can do one of two things&lt;/li&gt;
&lt;li&gt;One, spend time &amp;amp; learn the api&amp;rsquo;s of an existing inline editor&lt;/li&gt;
&lt;li&gt;Two, spend time creating a yet another inline editor, that I have full control of. (I&amp;rsquo;ll learn a lot of new things If I do this)&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;I did both, but after finding serveral small size inline editors, I decided to completely go ahead with creating a custom InlineEditor, it is not a major task if I used &lt;em&gt;document.executeCommand&lt;/em&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;maintaining demo/docs/npm package in single repo&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;backend&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;using firebase fn in combination with express&lt;/li&gt;
&lt;li&gt;firestore for database&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;I&amp;rsquo;ll explain &lt;strong&gt;&lt;em&gt;maintaining demo/docs/npm package in single repo&lt;/em&gt;&lt;/strong&gt; now, since that is the recent &amp;amp; last thing that I completed.&lt;/p&gt;
&lt;h2 id=&#34;maintaining-demo-docs-npm-package-in-single-repo&#34;&gt;Maintaining demo/docs/npm package in single repo&lt;/h2&gt;
&lt;p&gt;Let me fist explain the layout of the items in the repo.&lt;/p&gt;
&lt;p&gt;the repo contains,&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;create-react-app&lt;/em&gt; react-scripts by default for the demo page&lt;/li&gt;
&lt;li&gt;the &lt;em&gt;editor&lt;/em&gt; component
&lt;ul&gt;
&lt;li&gt;I want this to be bundled and published to npm&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;the demo branch, that automatically deploys with &lt;a href=&#34;https://pages.github.com/&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;github pages&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;api docs for the project&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;checklist that I created before starting work on this&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Its always better to plan ahead to avoid surprises later, created a small checklist to help me with this.&lt;/p&gt;
&lt;p&gt;I should have,&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;verified that the Editor is standalone
&lt;ul&gt;
&lt;li&gt;(i.e). that there is no demo build dependencies directly in the editor (like on first editor load, fetch this template from the backend, ..etc)&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;verified that the Editor is fully functional
&lt;ul&gt;
&lt;li&gt;(i.e). that the editor can be used in a demo page without problems&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;decided on what build system to use
&lt;ul&gt;
&lt;li&gt;webpack&lt;/li&gt;
&lt;li&gt;rollup&lt;/li&gt;
&lt;li&gt;nd&amp;hellip;etc, millions of other build systems out there&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;created the build system, in such a way that It wont affect the demo build (created with create-react-app)
&lt;ul&gt;
&lt;li&gt;at the time of writing this, react-scripts uses webpack v4, So installing another instance of webpack v5 for npm build, will cause react-scripts to fail, the same goes for its dependencies aswell.&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;created a seperate branch, do all documentations and changes in that branch&lt;/li&gt;
&lt;li&gt;bundled only selected files in the npm build, should only contain
&lt;ul&gt;
&lt;li&gt;editor&lt;/li&gt;
&lt;li&gt;css/sass files used with the editor&lt;/li&gt;
&lt;li&gt;image files used with the editor&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;created sepereate &lt;strong&gt;&lt;em&gt;scripts in package.json&lt;/em&gt;&lt;/strong&gt; for the differnet builds
&lt;ul&gt;
&lt;li&gt;build = for react-scripts-build&lt;/li&gt;
&lt;li&gt;build:module = for npm-build&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;created a seperate packge.json for the npm build, since the exported Editor component doesn&amp;rsquo;t need all the dependencies from the repository.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Choosing build system for the editor&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;I have already published packages using webpack in the past, So I already knew webpack and its different modules. But the problem is I don&amp;rsquo;t know if I can use two webpack instances in a single project.&lt;/p&gt;
&lt;p&gt;I Could go for a new build system just to solve this problem alone, Or find a way to use two webpack instances in a single project.&lt;/p&gt;
&lt;p&gt;This is the point in time, where I found out about &lt;a href=&#34;https://classic.yarnpkg.com/lang/en/docs/cli/add/#toc-yarn-add-alias&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;&lt;em&gt;yarn alias&lt;/em&gt;&lt;/a&gt;, After I found this, I knew which build system to choose (webpack v5).&lt;/p&gt;
&lt;p&gt;webpack has an environment configuration named &amp;lsquo;WEBPACK_PACKAGE&amp;rsquo;, it takes the package name of the webpack, So I can utilize this to install multiple versions, one with name &amp;lsquo;webpack&amp;rsquo; another with alias &amp;lsquo;webpack-module&amp;rsquo;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt; &amp;quot;webpack-module&amp;quot;: &amp;quot;npm:webpack@^5.60.0&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I can then run webpack normally with &amp;lsquo;react-scripts&amp;rsquo; and &amp;lsquo;WEBPACK_PACKAGE=webpack-module webpack&amp;rsquo; for npm build&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Requirements for publishing to npm&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;For publishing to npm, I need,&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;npm account&lt;/li&gt;
&lt;li&gt;a package.json with seperate dependencies from the demo package.json
&lt;ul&gt;
&lt;li&gt;there should be a two package.json now. One for demo build, another for package build&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;a webpack configuration file for bundling&lt;/li&gt;
&lt;li&gt;typescript definition file&lt;/li&gt;
&lt;li&gt;output of &lt;em&gt;npm pack&lt;/em&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Webpack configuration&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;webpack configuration should process&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;process scss, css and module css, scss.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href=&#34;https://webpack.js.org/loaders/style-loader/&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;style loader&lt;/a&gt; - Inject the bundled styles into webpage.&lt;/p&gt;
&lt;p&gt;since I used &lt;em&gt;@import&lt;/em&gt; for fonts and &lt;em&gt;url&lt;/em&gt; for background, I need to add &lt;a href=&#34;https://webpack.js.org/loaders/css-loader/&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;css loader&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;I have also used sass, thus &lt;a href=&#34;https://webpack.js.org/loaders/sass-loader/&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;sass loader&lt;/a&gt; is required. To note, for the modern web, there is &lt;a href=&#34;https://github.com/sass/dart-sass&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;dart sass&lt;/a&gt;. I can &lt;a href=&#34;https://webpack.js.org/loaders/sass-loader/#object&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;instruct &amp;ldquo;sass loader&amp;rdquo; to use &amp;ldquo;dart sass&amp;rdquo;&lt;/a&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;// css
{
test: /(\.css$|\.module\.css$)/i,
use: [&#39;style-loader-module&#39;, &#39;css-loader-module&#39;],
},
// scss
{
test: /(\.s[ac]ss$|\.module\.s[ac]ss$)/i,
use: [
{
loader: &#39;style-loader-module&#39;,
},
{
loader: &#39;css-loader-module&#39;,
options: {
importLoaders: 1,
modules: {
mode: &#39;local&#39;,
},
},
},
{
loader: &#39;sass-loader-module&#39;,
options: {
implementation: require(&#39;sass&#39;),
},
},
],
}
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;process .tsx, .ts and .jsx&amp;hellip;etc.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{
test: /\.(js|jsx|ts|tsx)$/,
exclude: /node_modules/,
use: {
loader: &#39;babel-loader-module&#39;,
options: {
presets: [
&#39;@babel/preset-env&#39;,
[&#39;@babel/preset-react&#39;, { runtime: &#39;automatic&#39; }],
&#39;@babel/preset-typescript&#39;,
],
},
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;instruct webpack to recognize .tsx file extensions.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;resolve: {
extensions: [&#39;.js&#39;, &#39;.jsx&#39;, &#39;.ts&#39;, &#39;.tsx&#39;],
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;a way to make image assets work in extensions,In webpack 5, I can bundle images inline in js files.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{
test: /\.svg/,
type: &#39;asset/inline&#39;,
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;That is it for the webpack config, Isn&amp;rsquo;t this simple and concise.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Maintaining another package.json for npm&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Obviously, only at the time of packing I need package.json untill then I can renaming to something else, I named it to &amp;lsquo;module-package.json&amp;rsquo; then at time of &amp;lsquo;bundling and packing&amp;rsquo;, I rename it to &amp;lsquo;package.json&amp;rsquo;&lt;/p&gt;
&lt;p&gt;the contents of &amp;lsquo;module-package.json&amp;rsquo; should contain the following,&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt; &amp;quot;name&amp;quot;: &amp;quot;dnd-email-editor&amp;quot;,
&amp;quot;version&amp;quot;: &amp;quot;v0.0.0-alpha.3&amp;quot;,
&amp;quot;description&amp;quot;: &amp;quot;Drag and Drop Editor designed for mails&amp;quot;,
&amp;quot;main&amp;quot;: &amp;quot;./main.js&amp;quot;,
&amp;quot;files&amp;quot;: [&amp;quot;**/*&amp;quot;],
&amp;quot;types&amp;quot;: &amp;quot;./index.d.ts&amp;quot;,
&amp;quot;peerDependencies&amp;quot;: {
&amp;quot;react&amp;quot;: &amp;quot;^17.0.1&amp;quot;,
&amp;quot;react-dom&amp;quot;: &amp;quot;^17.0.1&amp;quot;
},
&amp;quot;author&amp;quot;: &amp;quot;https://github.com/aghontpi&amp;quot;,
&amp;quot;license&amp;quot;: &amp;quot;GPL-3.0&amp;quot;,
&amp;quot;bugs&amp;quot;: {
&amp;quot;url&amp;quot;: &amp;quot;https://github.com/aghontpi/dnde/issues&amp;quot;
},
&amp;quot;homepage&amp;quot;: &amp;quot;https://github.com/aghontpi/dnde&amp;quot;,
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;On every version change, change &amp;ldquo;version&amp;rdquo; key, It&amp;rsquo;ll automatically update in &lt;a href=&#34;https://npmjs.com&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;npmjs&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;bundling and packing&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;I added the following command to package.json, (original package.json not &amp;lsquo;module-package.json&amp;rsquo;), note the environment variable &amp;lsquo;WEBPACK_PACKAGE&amp;rsquo; I mentioned from before.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;WEBPACK_PACKAGE=webpack-module webpack &amp;amp;&amp;amp;
cp module-package.json module/package.json &amp;amp;&amp;amp;
cp index.d.ts module/index.d.ts &amp;amp;&amp;amp;
cp README.md module/README.md &amp;amp;&amp;amp;
npm pack ./module/
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I can the publish the output from the previous command with&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;npm publish build-verion.tgz
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;conclusion&#34;&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;I oversimplified in many cases but this covers &amp;lsquo;publishing to npm part&amp;rsquo;. I solved a lot of similar interesting problems in the project, Check it &lt;a href=&#34;https://github.com/aghontpi/dnde&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;github dnde.&lt;/a&gt;&lt;/p&gt;</description></item><item><title>Html to React</title><link>//bluepie.in/2021/09/html-to-react/</link><pubDate>Sun, 26 Sep 2021 10:22:12 +0000</pubDate><guid>//bluepie.in/2021/09/html-to-react/</guid><description>
&lt;!--
mention, that the problem is recursive its recursive
react rerendering to manage key,
representation
handling headtag elements --&gt;
&lt;p&gt;I&amp;rsquo;ve been doing new development in my offtime and i&amp;rsquo;m totally enjoying the challenges and hurdles. I wanted to share an interesting problem that I solved, it is a small part on a project that is not public yet (as of 2021 SEP).&lt;/p&gt;
&lt;h2 id=&#34;problem&#34;&gt;Problem&lt;/h2&gt;
&lt;p&gt;I have a htmlString that I have to convert to react elements.&lt;/p&gt;
&lt;p&gt;but why?&amp;hellip; &lt;em&gt;the main reasons were&lt;/em&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;I have a react wrapper, that enhances the dom-elements.
&lt;ul&gt;
&lt;li&gt;I need this wrapper to handle all the elements.&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;because Dom Operations are expensive, but React is not &lt;a href=&#34;https://reactjs.org/docs/faq-internals.html&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;https://reactjs.org/docs/faq-internals.html&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;ok-how-do-i-solve-this-problem&#34;&gt;ok, how do I solve this problem?&lt;/h2&gt;
&lt;p&gt;step 1 :&lt;/p&gt;
&lt;p&gt;I need to parse the htmlString to a dom-tree. luckly there is &lt;a href=&#34;https://developer.mozilla.org/en-US/docs/Web/API/DOMParser&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;https://developer.mozilla.org/en-US/docs/Web/API/DOMParser&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;step 2:&lt;/p&gt;
&lt;p&gt;I need to convert the &lt;strong&gt;dom-tree to react elements&lt;/strong&gt; but how?. Since the dom is a tree, the problem is to transform the dom tree into a react tree, which if you give it a thought, it tends to have a &lt;strong&gt;recursive structure&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;step 3:&lt;/p&gt;
&lt;p&gt;Identify the api-calls that are needed to transform the dom-tree into a react tree. Checking the docs, I only need one, &lt;a href=&#34;https://reactjs.org/docs/react-api.html#createelement&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;https://reactjs.org/docs/react-api.html#createelement&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;step 4:&lt;/p&gt;
&lt;p&gt;Attach my wrapper to it.&lt;/p&gt;
&lt;h2 id=&#34;domparser-domtree-from-string&#34;&gt;DomParser, Domtree from string&lt;/h2&gt;
&lt;p&gt;I was supprised to find that many people don&amp;rsquo;t know about &lt;a href=&#34;https://developer.mozilla.org/en-US/docs/Web/API/DOMParser&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;https://developer.mozilla.org/en-US/docs/Web/API/DOMParser&lt;/a&gt;. It has a &lt;strong&gt;constructor&lt;/strong&gt;, which takes a string and returns a dom-tree. I believe this is best way to parse html to dom-tree.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-typescript&#34;&gt;const domParser: any = new DOMParser();
export const htmlProcessor = (html: string): ReactNode =&amp;gt; {
if (typeof html !== &#39;string&#39;) {
console.error(&#39;htmlParser: html is not a string&#39;);
return React.createElement(&#39;p&#39;, {}, &#39;errors: please check dev console&#39;) as ReactNode;
}
let doc = domParser.parseFromString(html, &#39;text/html&#39;);
if (doc === null) {
console.error(&#39;htmlParser: unable to process html&#39;);
return React.createElement(&#39;p&#39;, {}, &#39;errors: please check dev console&#39;) as ReactNode;
}
};
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;writing-a-function-that-converts-dom-tree-and-returns-a-react-tree&#34;&gt;Writing a function that converts dom-tree and returns a react-tree&lt;/h2&gt;
&lt;p&gt;With &lt;a href=&#34;https://reactjs.org/docs/react-api.html#createelement&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;React.createElement&lt;/a&gt;, I can create a react-element.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-typescript&#34;&gt;const nodeName = &#39;div&#39;;
const attributes = {
className: &#39;class-name-that-i-want&#39;, // note: attributes must be camelCase
id: &#39;created_by_custom&#39;,
};
const children = null; // note: if not null, the children should also be react nodes, ie the output from createElement.
React.createElement(nodeName, attributes, children);
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;experimenting with a little example above, I identified three things.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;I need tagName, (&amp;lsquo;div&amp;rsquo;, &amp;lsquo;span&amp;rsquo;,etc)&lt;/li&gt;
&lt;li&gt;I need attributes, (key,className, id, etc)&lt;/li&gt;
&lt;li&gt;I need children, (null, react-elements, text )&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;em&gt;So lets begin&lt;/em&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;I Have to be careful here, I do this operation for every user action. So to maintain perfomance I need to maintain key consistency,&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;so what is key, why I&amp;rsquo;m stressing about it?. &lt;a href=&#34;https://reactjs.org/docs/glossary.html#keys&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;key React Docs&lt;/a&gt;. after going through the docs, see the example below, if i add a new element below &lt;em&gt;&lt;strong&gt;div key=&amp;ldquo;4&amp;rdquo;&lt;/strong&gt;&lt;/em&gt;, all elements after &lt;em&gt;&lt;strong&gt;key=5&lt;/strong&gt;&lt;/em&gt;, will be recreated with differnet keys. This will cause react algorithm to rerender all the elements with the new key.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-text&#34;&gt;div key=&amp;quot;1&amp;quot;
div key=&amp;quot;2&amp;quot;
div key=&amp;quot;3&amp;quot;
div key=&amp;quot;4&amp;quot;
div key=&amp;quot;5&amp;quot;
div key=&amp;quot;6&amp;quot;
div key=&amp;quot;7&amp;quot;
div key=&amp;quot;8&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Instead I need to generate keys in the following structure, this way I can maintain key consistency in the virtual-dom. If I were to append a &lt;strong&gt;&lt;em&gt;new element to div &amp;lsquo;new-child-add&amp;rsquo;, only the div &amp;lsquo;new-child-add&amp;rsquo; and its children will be rerendered.&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-text&#34;&gt;div key=&amp;quot;1&amp;quot;
div id=&amp;quot;new-child-add&amp;quot; key=&amp;quot;1&amp;quot;
div key=&amp;quot;1&amp;quot;
div key=&amp;quot;2&amp;quot;
div key=&amp;quot;2&amp;quot;
div key=&amp;quot;1&amp;quot;
div key=&amp;quot;2&amp;quot;
div key=&amp;quot;1&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;hr /&gt;
&lt;h2 id=&#34;keeping-the-things-above-in-mind-i-wrote-the-following-function&#34;&gt;Keeping the things above in mind, I wrote the following function.&lt;/h2&gt;
&lt;p&gt;Define a function that takes a dom-element. I need to call this recursively later. To maintain key consistency, I also need to pass the key as a parameter.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-typescript&#34;&gt;const converter = (element: HTMLElement, key = 0) =&amp;gt; {
if (element === undefined) {
return;
}
};
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I need to get the nodeName and attributes for the current element first. I use &lt;a href=&#34;https://developer.mozilla.org/en-US/docs/Web/API/Node/nodeName&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;nodeName&lt;/a&gt;, &lt;a href=&#34;https://developer.mozilla.org/en-US/docs/Web/API/Element/attributes&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;attributes&lt;/a&gt; &amp;amp; &lt;a href=&#34;https://reactjs.org/docs/dom-elements.html#style&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;style&lt;/a&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-typescript&#34;&gt;const nodeName = element.nodeName.toLowerCase();
let attributes: { [key: string]: string | any } = {};
for (var i = 0; element.attributes &amp;amp;&amp;amp; i &amp;lt; element.attributes.length; i++) {
const attribute = element.attributes[i];
const reactName = toCamelCase(attribute.name);
let value = attribute.name === &#39;style&#39; ? convertStyleStringToObject(attribute.value) : attribute.value.trim();
attributes[reactName] = value;
}
attributes[&#39;key&#39;] = key++;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Before creating the element, I need to process all the child nodes, if there are any. I use &lt;a href=&#34;https://developer.mozilla.org/en-US/docs/Web/API/Node/childNodes&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;childNodes&lt;/a&gt;. Note that &amp;lsquo;#text&amp;rsquo; have to be handled separately, because it is not a dom-element, its just a string. Also note, I called the function recursively.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-typescript&#34;&gt;let children: ReactNode[] = [];
for (let i = 0; i &amp;lt; element.childNodes.length; i++) {
let child = element.childNodes[i];
if (child[&#39;nodeName&#39;] === &#39;#text&#39;) {
if (child.textContent) {
const content = child.textContent.replaceAll(&#39;\n&#39;, &#39;&#39;);
content &amp;amp;&amp;amp; child.push(content);
}
continue;
}
if (child[&#39;nodeName&#39;] === &#39;#comment&#39;) {
continue; // I dont want to render comments
}
if (nodeName !== &#39;script&#39; &amp;amp;&amp;amp; nodeName !== &#39;style&#39;) {
children.push(converter(child as HTMLElement, key++)); //recursive call
}
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I have all the properties, now I can create the element.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-typescript&#34;&gt;return React.createElement(nodeName, attributes, children);
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;My function is now complete. I call my wrapper function in different locations based on the type of the element and its attributes.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-typescript&#34;&gt;const domParser: any = new DOMParser();
export const htmlProcessor = (html: string): ReactNode =&amp;gt; {
if (typeof html !== &#39;string&#39;) {
console.error(&#39;htmlParser: html is not a string&#39;);
return React.createElement(&#39;p&#39;, {}, &#39;errors: please check dev console&#39;) as ReactNode;
}
let doc = domParser.parseFromString(html, &#39;text/html&#39;);
if (doc === null) {
console.error(&#39;htmlParser: unable to process html&#39;);
return React.createElement(&#39;p&#39;, {}, &#39;errors: please check dev console&#39;) as ReactNode;
}
return converter(doc as unknown as HTMLElement, 1);
};
const converter = (element: HTMLElement, key = 0) =&amp;gt; {
if (element === undefined) {
return;
}
const nodeName = element.nodeName.toLowerCase();
let attributes: { [key: string]: string | any } = {};
for (var i = 0; element.attributes &amp;amp;&amp;amp; i &amp;lt; element.attributes.length; i++) {
const attribute = element.attributes[i];
const reactName = toCamelCase(attribute.name);
let value = attribute.name === &#39;style&#39; ? convertStyleStringToObject(attribute.value) : attribute.value.trim();
attributes[reactName] = value;
}
attributes[&#39;key&#39;] = key++;
let children: ReactNode[] = [];
/**
* wrapper logic here and return the element. If I only want the attributes
* to be processed, but dont want to process the children.
*/
for (let i = 0; i &amp;lt; element.childNodes.length; i++) {
let child = element.childNodes[i];
if (child[&#39;nodeName&#39;] === &#39;#text&#39;) {
if (child.textContent) {
const content = child.textContent.replaceAll(&#39;\n&#39;, &#39;&#39;);
content &amp;amp;&amp;amp; child.push(content);
}
continue;
}
if (child[&#39;nodeName&#39;] === &#39;#comment&#39;) {
continue;
}
if (nodeName !== &#39;script&#39; &amp;amp;&amp;amp; nodeName !== &#39;style&#39;) {
children.push(converter(child as HTMLElement, key++));
}
}
/**
* wrapper logic here and return the element. If I want the attrbibutes
* and children to be processed.
*/
return React.createElement(nodeName, attributes, children);
};
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;end&#34;&gt;End&lt;/h1&gt;
&lt;p&gt;This was a fun problem to solve, well that marks the end. ~seeya&lt;/p&gt;
&lt;hr /&gt;
&lt;blockquote&gt;
&lt;p&gt;I mention the edge cases below, Only read it, if you are interested.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;edge-cases&#34;&gt;Edge cases&lt;/h2&gt;
&lt;p&gt;There are the following edge cases that I have not covered in this article. But I have in my project,&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;img tag should not have child param passed to it&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-typescript&#34;&gt;if (nodeName === &#39;img&#39;) {
return React.createElement(nodeName, { key: key++, ...attributes }, null);
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;if its a text node, then its children should be a string.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-typescript&#34;&gt;if (element.nodeType === 3) {
return React.createElement(nodeName, { ...attributes, key: key++ }, element.textContent);
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;handling &amp;lsquo;&amp;lt;head&amp;gt;&amp;rsquo; tag is different too, because each tag with its different property servers a different purpose.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-typescript&#34;&gt;let el;
switch (nodeName) {
case &#39;meta&#39;:
el = element as HTMLMetaElement;
// meta tag has http-equiv attribute &amp;amp; content attribute, but no children
return React.createElement(nodeName, { httpEquiv: el.httpEquiv, content: el.content, key: nodeName + key++ }, null);
case &#39;link&#39;:
el = element as HTMLLinkElement;
let type = null;
if (el.type) {
type = el.type;
}
// external link has rel attribute &amp;amp; href attribute, but no children
return React.createElement(
nodeName,
{
href: el.href,
rel: el.rel,
type,
key: nodeName + key++,
},
null
);
case &#39;br&#39;:
return React.createElement(nodeName, { key: nodeName + key++ }, null);
case &#39;title&#39;:
case &#39;script&#39;:
case &#39;style&#39;:
// script/style/title tags have no children
// script &amp;amp; style have contents in them, so innerHTML
return React.createElement(nodeName, {
dangerouslySetInnerHTML: { __html: element.innerHTML, key: nodeName + key++ },
});
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;</description></item><item><title>Android Reversing Part 5 But With Frida</title><link>//bluepie.in/2021/08/android-reversing-part-5-with-frida/</link><pubDate>Sat, 21 Aug 2021 07:25:55 +0000</pubDate><guid>//bluepie.in/2021/08/android-reversing-part-5-with-frida/</guid><description>
&lt;h2 id=&#34;why-frida&#34;&gt;Why Frida?&lt;/h2&gt;
&lt;p&gt;Becase it can be many things, &lt;a href=&#34;https://frida.re/&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;know more&lt;/a&gt;. Its is,&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;easy, sure learning curve takes some time, but it pays off spectacularly.&lt;/li&gt;
&lt;li&gt;efficient, a rough estimate for the modification took 30 min in frida vs 2 hours in traditional methods, its way more flexible.&lt;/li&gt;
&lt;li&gt;elegant when compared to traditional ways. you get creative new ideas and implement them easily (implementating manually takes way longer).&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;my-setup&#34;&gt;My setup&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;a href=&#34;https://www.genymotion.com/&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;Genymotion&lt;/a&gt;, but why? (better than avd) runs way faster than avd, default root, runs via virtual box, image size is small, less cpu usage compared to avd.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;latest frida server and client from &lt;a href=&#34;https://github.com/frida/frida/releases&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;frida/releases&lt;/a&gt;.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;in my case, &lt;a href=&#34;https://github.com/frida/frida/releases/download/15.0.17/frida-server-15.0.17-android-x86.xz&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;&amp;lsquo;frida-server-15.0.17-android-arm.xz&amp;rsquo;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;move the fridaserver to android device/emulator and start it.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;adb push /data/local/tmp/firda-server
adb shell
cd /data/local/tmp/frida-server
./frida-server &amp;amp;
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;modding-with-very-little-effort&#34;&gt;Modding with very little effort&lt;/h2&gt;
&lt;p&gt;Frida has a great feature &lt;strong&gt;&amp;lsquo;TRACE&amp;rsquo;&lt;/strong&gt;, but without manually injection, by doing it dynamically, &lt;a href=&#34;https://frida.re/docs/frida-trace/&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;more here&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;what it does in oneline is &lt;strong&gt;you give it &amp;lsquo;wildcard methods&amp;rsquo; and a process, it will then log the input params and out values when the traced method is called of the target process&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;# for tracing all methods which contains &#39;license&#39;
noone@pc:frida-trace -U Firewall -j &#39;*!*license*/isu&#39;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;Trace Logs&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt; 26442 ms Settings.isLicenseActive(&amp;quot;&amp;lt;instance: android.content.Context, $className: com.protectstar.firewall.activity.ActivityRules&amp;gt;&amp;quot;)
26443 ms &amp;lt;= false
26598 ms Settings.isLicenseActive(&amp;quot;&amp;lt;instance: android.content.Context, $className: com.protectstar.firewall.activity.ActivityRules&amp;gt;&amp;quot;)
26599 ms &amp;lt;= false
26603 ms Settings.isLicenseActive(&amp;quot;&amp;lt;instance: android.content.Context, $className: com.protectstar.firewall.activity.ActivityRules&amp;gt;&amp;quot;)
26604 ms &amp;lt;= false
39331 ms Settings.isLicenseActive(&amp;quot;&amp;lt;instance: android.content.Context, $className: com.protectstar.firewall.activity.settings.Settings&amp;gt;&amp;quot;)
39331 ms &amp;lt;= false
45614 ms Settings.isLicenseActive(&amp;quot;&amp;lt;instance: android.content.Context, $className: com.protectstar.firewall.activity.settings.Settings&amp;gt;&amp;quot;)
45614 ms &amp;lt;= false
49377 ms Settings.isLicenseActive(&amp;quot;&amp;lt;instance: android.content.Context, $className: com.protectstar.firewall.activity.ActivityLogs&amp;gt;&amp;quot;)
49378 ms &amp;lt;= false
49567 ms &amp;lt;= false
49581 ms Settings.isLicenseActive(&amp;quot;&amp;lt;instance: android.content.Context, $className: com.protectstar.firewall.activity.ActivityLogs&amp;gt;&amp;quot;)
49581 ms &amp;lt;= false
52637 ms Settings.isLicenseActive(&amp;quot;&amp;lt;instance: android.content.Context, $className: com.protectstar.firewall.activity.settings.SettingsInApp&amp;gt;&amp;quot;)
52637 ms &amp;lt;= false
52786 ms Settings.isLicenseActive(&amp;quot;&amp;lt;instance: android.content.Context, $className: com.protectstar.firewall.activity.settings.SettingsInApp&amp;gt;&amp;quot;)
52789 ms &amp;lt;= false
52792 ms SettingsInApp.initLicense()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;With just guessing the method name &amp;lsquo;license&amp;rsquo;, following license methods were found and its input and output params are logged when run via adb, without even decompiling and going through code (isn&amp;rsquo;t this great!?)&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;8 directories, 31 files
__handlers__/
├── com.protectstar.firewall.activity.settings.Settings
│   └── isLicenseActive.js &amp;lt;--- this file seems interesting?!
├── com.protectstar.firewall.activity.settings.SettingsInApp
│   ├── initLicense.js
...
│   └── licenseSuccess.js
├── com.protectstar.firewall.cloud.Auth
│   ├── getLicense1Url.js
...
├── com.protectstar.firewall.utility.LicenseActivation
│   ├── access_000.js
...
│   ├── checkLicenseDuration.js &amp;lt;--- this file seems interesting?!
│   └── _init.js
├── com.protectstar.firewall.utility.LicenseActivation_Customer
...
│   ├── access_900.js
│   └── _init.js
├── com.protectstar.firewall.utility.LicenseActivation_Reason
│   ├── valueOf.js
│   └── values.js
├── com.protectstar.firewall.utility.LicenseActivation_ResponseListener
   ├── error.js
   └── licenseSuccess.js
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Now navigate though all sections of the app and find any interesting methods invoked through the trace logs.&lt;/p&gt;
&lt;h2 id=&#34;patching-on-the-fly-without-seeing-the-original-code&#34;&gt;patching on the fly, without seeing the original code&lt;/h2&gt;
&lt;p&gt;By observing the invoked methods and its input/output values, we can guess the method name to patch, it is &lt;em&gt;&amp;lsquo;isLicenseActive&amp;rsquo; from &amp;lsquo;com.protectstar.firewall.activity.settings.Settings&amp;rsquo;&lt;/em&gt;, in frida-trace, we see the return value is &lt;em&gt;False&lt;/em&gt;, so why not make it as true and observe the behaviour?&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;// patching the method
function main() {
Java.perform(function () {
// match the method signature
Java.use(&#39;com.protectstar.firewall.activity.settings.Settings&#39;).isLicenseActive.implementation = function (
context
) {
return true;
};
});
}
setImmediate(main);
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;After patching, navigating the app we now see the premium features are unlocked, that was way easier than conventional methods, greatly reduces the time.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;//bluepie.in/images/posts/android-reversing-part-5/patch_with_frida_accessing_premium.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
&lt;h2 id=&#34;end&#34;&gt;End&lt;/h2&gt;
&lt;p&gt;I intend to use Frida in the future stuff I do, its simply great. Seeya next time. untill then - aghontpi :)&lt;/p&gt;</description></item><item><title>Android Reversing Part 5</title><link>//bluepie.in/2021/07/android-reversing-part-5/</link><pubDate>Fri, 16 Jul 2021 15:00:24 +0000</pubDate><guid>//bluepie.in/2021/07/android-reversing-part-5/</guid><description>
&lt;hr /&gt;
&lt;h1 id=&#34;contents&#34;&gt;Contents&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;#why--motivation&#34;&gt;Why &amp;amp; Motivation&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#decompiling&#34;&gt;Decompiling&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#finding-where-to-patch&#34;&gt;Finding where to patch&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#patching-recompiling-and-installing-it-on-device&#34;&gt;Patching, recompiling and installing it on device&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#premium-features-does-not-work-fully&#34;&gt;App&amp;rsquo;s premium features does not work fully&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#finding-integrity-checks-digging-deeper-for-final-patch&#34;&gt;Finding integrity checks, digging deeper for final patch.&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#end&#34;&gt;End&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;why-motivation&#34;&gt;Why &amp;amp; Motivation&lt;/h2&gt;
&lt;p&gt;I wanted to monitor my mobile network traffic after I found some wierd dns logs in my custom dns server, I could not figure out which app made that request thus I found out this &lt;a href=&#34;https://play.google.com/store/apps/details?id=com.protectstar.firewall&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;app&lt;/a&gt; in playstore called &amp;lsquo;No Root Firewall, Internet Data Blocker Protection&amp;rsquo;. it had good ui and satisfied 60% of my usage needs. The downside of this is they require a montly subscription for app features. This is bit much if you ask me so decided to mod it for personal use. &lt;em&gt;In my defense, I did purchase it for a month.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;//bluepie.in/images/posts/android-reversing-part-5/orderhistoryforfirewall.png&#34; alt=&#34;Proof that I bought this thing&#34; /&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;My past posts cover which tools I use, how to decompile, configs, etc.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;decompiling&#34;&gt;Decompiling&lt;/h2&gt;
&lt;p&gt;Extracing the app.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;
pm path com.placeholder.app
adb pull path_of_apk # one by one
# we get the following files
-rw-rw-r-- 1 nouser nouser 6273850 base.apk
-rw-rw-r-- 1 nouser nouser 90809 split_config.arm64_v8a.apk
-rw-rw-r-- 1 nouser nouser 126542 split_config.xxhdpi.apk
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This app uses &lt;a href=&#34;https://developer.android.com/guide/app-bundle&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;app bundle&lt;/a&gt; so we make use of &amp;ndash;use-aapt2 flag in apk-tool &lt;em&gt;I am using apktool v2.5.0&lt;/em&gt;&lt;/p&gt;
&lt;h2 id=&#34;finding-where-to-patch&#34;&gt;Finding where to patch&lt;/h2&gt;
&lt;p&gt;after decompiling, immediately in mainActivity we find a call to this,&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;//from
public static boolean hasSubscription(Context context) {
if (Settings.isLicenseActive(context)) {
return true;
}
try {
Subscription subscription = (Subscription) new TinyDB(context).getObject(Settings.SAVE_KEY_SUBSCRIPTION, Subscription.class);
if (subscription == Subscription.Month || subscription == Subscription.Year || subscription == Subscription.Lifetime) {
return true;
}
return false;
} catch (Exception unused) {
return false;
}
}
// to
public static boolean hasSubscription(Context context){
return true;
}
//from
public static boolean isLifeTime(Context context) {
if (!hasSubscription(context)) {
return false;
}
try {
if (((Subscription) new TinyDB(context).getObject(Settings.SAVE_KEY_SUBSCRIPTION, Subscription.class)) == Subscription.Lifetime) {
return true;
}
return false;
} catch (Exception unused) {
return false;
}
}
//to
public static boolean isLifeTime(Context context){
return true;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Smali logic for return true.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-smali&#34;&gt;
const/4 v1, 0x1
return v1
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;patching-recompiling-and-installing-it-on-device&#34;&gt;Patching, recompiling and installing it on device&lt;/h2&gt;
&lt;p&gt;while recompiling and signing, sign all the split apks with the same key, even if you did not touch the other split apks.
(this is because android expects all the split apks to have the same signature)&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;
zip -d ./split_config.arm64_v8a.apk META-INF/\*
zip -d ./split_config.xxhdpi.apk META-INF/\*
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;then sign them as mentioned from my previous posts.&lt;/p&gt;
&lt;p&gt;For installing, since we have 3 apks&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;
├── base.apk
├── split_config.arm64_v8a.apk
└── split_config.xxhdpi.apk
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;
adb install-multiple ./base.apk ./split_config.arm64_v8a.apk ./split_config.xxhdpi.apk
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;premium-features-does-not-work-fully&#34;&gt;Premium features does not work fully&lt;/h2&gt;
&lt;p&gt;After installing and using it, it was apparent that some of the premium features were not working, like filter lists provided by the app, ip information and location presented visually in map.&lt;/p&gt;
&lt;p&gt;In situations like this, there could be only one possible scenario and that is an additional check, it may be in the form of&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;app integrity, whether the app was tampered&lt;/li&gt;
&lt;li&gt;was it not installed from google play store&lt;/li&gt;
&lt;li&gt;verifying the purchase information via google services,&lt;/li&gt;
&lt;li&gt;based on implementor&amp;rsquo;s thought process..etc,&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;finding-integrity-checks-digging-deeper-for-final-patch&#34;&gt;Finding integrity checks, digging deeper for final patch.&lt;/h2&gt;
&lt;p&gt;Digging deeper we find the app along with integrity check,&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;
public static boolean detect(Context context) {
PackageInfo packageInfo;
Signature[] signatureArr;
try {
if (Build.VERSION.SDK_INT &amp;gt;= 28) {
packageInfo = context.getPackageManager().getPackageInfo(context.getPackageName(), 134217728);
} else {
packageInfo = context.getPackageManager().getPackageInfo(context.getPackageName(), 64);
}
if (Build.VERSION.SDK_INT &amp;lt; 28) {
signatureArr = packageInfo.signatures;
} else if (packageInfo.signingInfo.hasMultipleSigners()) {
signatureArr = packageInfo.signingInfo.getApkContentsSigners();
} else {
signatureArr = packageInfo.signingInfo.getSigningCertificateHistory();
}
try {
String calculateSHA = calculateSHA(&amp;quot;SHA-1&amp;quot;, signatureArr[0].toByteArray());
if (calculateSHA.equalsIgnoreCase(&amp;quot;44F217A05AE9E2A8FB0F627528EABF8855FBC274&amp;quot;) || calculateSHA.equalsIgnoreCase(&amp;quot;8aa072cdd29068b79d30cbff9afb2d3ab89e7ec4&amp;quot;) || calculateSHA.equalsIgnoreCase(&amp;quot;dfe607e53da092636e47789497365fca36589cba&amp;quot;)) {
return false;
}
return true;
} catch (Exception e) {
e.printStackTrace();
return false;
}
} catch (Throwable unused) {
return false;
}
}
private static String calculateSHA(String str, byte[] bArr) {
try {
return FileUtils.byte2HexFormatted(MessageDigest.getInstance(str).digest(bArr));
} catch (Exception e) {
e.printStackTrace();
return &amp;quot;&amp;quot;;
}
}
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;So add it to the list of item to patch.&lt;/p&gt;
&lt;p&gt;smali equivalent&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-smali&#34;&gt;
const/4 v1,0x0
return v1
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Interestingly we also find lucky patcher detection, I don&amp;rsquo;t use lucky patcher, so ignorning this.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;
public static boolean hasLuckyPatcher(Context context) {
PackageManager packageManager = context.getPackageManager();
return isPackageInstalled(&amp;quot;ru.aaaaaaad.installer&amp;quot;, packageManager) || isPackageInstalled(&amp;quot;ru.sxbuIDfx.pFSOyagrF&amp;quot;, packageManager) || isPackageInstalled(&amp;quot;ru.HUounqZv.qGDvALdrY&amp;quot;, packageManager) || isPackageInstalled(&amp;quot;ru.yFarPSsi.lSWLCBgGE&amp;quot;, packageManager) || isPackageInstalled(&amp;quot;ru.auLSaZJK.OldqqVPqY&amp;quot;, packageManager) || isPackageInstalled(&amp;quot;ru.HvZVLLax.FuBLzbTId&amp;quot;, packageManager) || isPackageInstalled(&amp;quot;ru.FxCVdppm.yVDnvQgJU&amp;quot;, packageManager) || isPackageInstalled(&amp;quot;ru.oCHfhtgN.LaiQlIeIK&amp;quot;, packageManager) || isPackageInstalled(&amp;quot;ru.ohHbeFjR.uZvxvLPnK&amp;quot;, packageManager) || isPackageInstalled(&amp;quot;ru.oSFnVIfs.fUUFExgWn&amp;quot;, packageManager) || isPackageInstalled(&amp;quot;ru.PDOIPrWH.abjKeIKLW&amp;quot;, packageManager) || isPackageInstalled(&amp;quot;ru.UaLzEHLI.yXTTBtSFW&amp;quot;, packageManager) || isPackageInstalled(&amp;quot;ru.uBVJgfKc.udsaLjziD&amp;quot;, packageManager) || isPackageInstalled(&amp;quot;com.chelpus.lackypatch&amp;quot;, packageManager) || isPackageInstalled(&amp;quot;com.dimonvideo.luckypatcher&amp;quot;, packageManager) || isPackageInstalled(&amp;quot;com.luckypatchers.luckypatcherinstaller&amp;quot;, packageManager) || isPackageInstalled(&amp;quot;com.android.vending.billing.InAppBillingService.LACK&amp;quot;, packageManager) || isPackageInstalled(&amp;quot;com.android.vending.billing.InAppBillingService.COIN&amp;quot;, packageManager) || isPackageInstalled(&amp;quot;com.android.vending.billing.InAppBillingService.LOCK&amp;quot;, packageManager) || isPackageInstalled(&amp;quot;com.android.vending.billing.InAppBillingService.CRAC&amp;quot;, packageManager) || isPackageInstalled(&amp;quot;com.android.vending.billing.InAppBillingService.COIO&amp;quot;, packageManager);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This time, we also mod the isLicenseActive setting function, since there are a number of calls from others parts of the app, I did not notice this earlier.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;// from
public static boolean isLicenseActive(Context context) {
TinyDB tinyDB = new TinyDB(context);
String string = tinyDB.getString(LicenseActivation.SAVE_KEY_EXPIRE_DATE, &amp;quot;&amp;quot;);
if (!string.isEmpty()) {
if (string.equals(&amp;quot;0&amp;quot;)) {
return true;
}
try {
if (new Date().getTime() &amp;lt;= new SimpleDateFormat(&amp;quot;yyyyMMdd&amp;quot;, Locale.getDefault()).parse(string).getTime()) {
return true;
}
tinyDB.removeKey(LicenseActivation.SAVE_KEY_EXPIRE_DATE);
checkProfessional(context, false, null);
return false;
} catch (ParseException unused) {
}
}
return false;
}
//to
public static boolean isLicenseActive(Context context) {
return true;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Patch the two places noted before, repeat the recompiling and installation step.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Now The app works with all the premium features.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;end&#34;&gt;End&lt;/h2&gt;
&lt;p&gt;I dont have to pay 3k every year for using this app.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;If this post offends you in any way, contact me to it take it down.&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;</description></item><item><title>Frontend Updates &amp; Rinku Project Upgrade</title><link>//bluepie.in/2021/05/react-updates-rinku-upgrade/</link><pubDate>Fri, 28 May 2021 20:21:39 +0000</pubDate><guid>//bluepie.in/2021/05/react-updates-rinku-upgrade/</guid><description>
&lt;p&gt;&lt;em&gt;Hi!, Like I mentioned in my last update, I took a break from everything ( a month and 3 weeks), the reason behind me missing my post on past month(april). I still had to do office work though, but its&amp;rsquo; alright because it was fun. The time off that I took was the best decision in a while, It helped me rethink priorities.&lt;/em&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Like I said in &lt;a href=&#34;https://bluepie.in/2021/03/firebase-realtimedatabase/&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;march post 2021&lt;/a&gt;, I&amp;rsquo;ll be posting with new Time management in mind.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;react-update&#34;&gt;React Update&lt;/h2&gt;
&lt;p&gt;I&amp;rsquo;ve been working on react projects and learning new things, So i&amp;rsquo;ve decided, that I should upgrade(a barebone react project that I cooked up a while ago called Rinku). &lt;em&gt;upgraded from v1.x.x to v2.x&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Release contains the seperate commits for each change&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/aghontpi/Rinku-Frontend/releases/tag/v2.0.0&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;Release 2.x&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Updates that I did&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;javascript -&amp;gt; typescript&lt;/li&gt;
&lt;li&gt;Redux, Redux-toolkit, Redux-Saga&lt;/li&gt;
&lt;li&gt;semantic-ui -&amp;gt; semantic-ui react&lt;/li&gt;
&lt;li&gt;Project structure, File naming structure&lt;/li&gt;
&lt;li&gt;React 16.x -&amp;gt; 17.x&lt;/li&gt;
&lt;li&gt;remove jquery dependency&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;project-structure-update&#34;&gt;Project Structure Update&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;My current preferred way of setting up folders&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Name&lt;/th&gt;
&lt;th&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;src&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Source files for server&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;src/public/&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Static files to be used on client side&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;src/Saga/&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Redux-Saga files&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;src/Saga/*.saga.ts&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Individual Saga files&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;src/Saga/network.ts&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Server Communication logic&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;src/Store/&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Redux/Redux-toolkit files&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;src/Store/*.store.ts&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Individual Store files&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;src/Hooks/*.hook.ts&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Custom hooks&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;src/Containers/&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Every page for the app&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;src/Components/&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Common components for the whole app&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;src/Route/&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;All Route setup&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;src/Utils/&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Common logic throught the whole app&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;src/Style/&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Style and assests, since create-react-app does not allow files outside src/ to be imported&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;.env.development&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Development variables, configuring backend, etc.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;.env.production&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Development variables but for production&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;time-management&#34;&gt;Time Management&lt;/h2&gt;
&lt;p&gt;I cameback from my break on 22nd this month, Spent the last week of this month for upgrading this react project, Because of that I didn&amp;rsquo;t have time to do other things.&lt;/p&gt;
&lt;h3 id=&#34;next-month-s-schedule&#34;&gt;Next month&amp;rsquo;s schedule&lt;/h3&gt;
&lt;p&gt;I should, get back to work on my Scrum board.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;week 1 &amp;amp; 2&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Complete the Friend feature, merge it with master branch.&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;week 3 &amp;amp; 4&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;reafactor to use redux-toolkit&lt;/li&gt;
&lt;li&gt;move to redux async handlers&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;note-to-future-self&#34;&gt;Note to future-self&lt;/h2&gt;
&lt;p&gt;Last year, It was trying to forget the month of May, but this year, not so much. Great, Hope this continues.&lt;/p&gt;</description></item><item><title>Firebase-RealtimeDatabase &amp; Self-assesment</title><link>//bluepie.in/2021/03/firebase-realtimedatabase/</link><pubDate>Mon, 29 Mar 2021 19:08:42 +0000</pubDate><guid>//bluepie.in/2021/03/firebase-realtimedatabase/</guid><description>
&lt;p&gt;&lt;em&gt;Hi!, its been a wild month, jumping all over the places, future me reading!, keep your composure.&lt;/em&gt; &lt;strong&gt;Coming to other things, I&amp;rsquo;ve been doing work from home for the past year, but recently (the past 3 months) I was asked to come office atleast a week or two. Although some of my friends are still doing WFM, I had to go chennai, Which I felt was bad, but this is not a major consern.&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&#34;time-management-upuntill-now&#34;&gt;Time Management upuntill now&lt;/h2&gt;
&lt;p&gt;I&amp;rsquo;ve been managing three different workflows in my life(tech side),&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;office&lt;/li&gt;
&lt;li&gt;hobbies (this is where I maintain my public journal, &lt;strong&gt;posting here&lt;/strong&gt; )&lt;/li&gt;
&lt;li&gt;learning new stuff&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Which often makes me wana take a break from everything(like the one I&amp;rsquo;m about to take, 20-30 days), after an assesment that I made myself, I&amp;rsquo;ve decided its not good for me to continue this way, &lt;em&gt;I am juggling too much things at once&lt;/em&gt;.&lt;/p&gt;
&lt;h2 id=&#34;time-management-going-forward&#34;&gt;Time management going forward&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;office&lt;/li&gt;
&lt;li&gt;hobbies &amp;amp; learning new stuff (combining hobbies and learning new stuff as a public journal)&lt;/li&gt;
&lt;/ul&gt;
&lt;hr /&gt;
&lt;blockquote&gt;
&lt;p&gt;Due to the said change, The jorunal will now contain&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://en.wikipedia.org/wiki/Scrum_(software_development)&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;Scrum&lt;/a&gt; of hobby &amp;amp; learning projects.&lt;/li&gt;
&lt;li&gt;where did I spent my time (on tech)each month.&lt;/li&gt;
&lt;li&gt;Reverse engineering/Modding/Programming/Competitions.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;things-i-have-completed-in-this-month-in-my-freetime&#34;&gt;Things I have completed in this month in my freetime.&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;design &amp;amp; implement searching/adding friends in an RN app that I am building.&lt;/li&gt;
&lt;li&gt;create an animation from scratch for RN using RN reanimated.&lt;/li&gt;
&lt;li&gt;restructure RealtimeDatabase to manage follow requests and friends.&lt;/li&gt;
&lt;li&gt;managing firebase rules for differnet roots/refs.&lt;/li&gt;
&lt;li&gt;refactor firebase connection&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;design-and-implement-searching-adding-friends&#34;&gt;design and implement searching/adding friends&lt;/h4&gt;
&lt;p&gt;I took inspiration from twitter and this is how Im panning it out.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;//bluepie.in/images/posts/march-2021/design.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
&lt;h4 id=&#34;creating-an-animation-similar-to-twitter-s-search-and-trending-from-scratch&#34;&gt;creating an animation similar to twitter&amp;rsquo;s search and trending from &lt;strong&gt;&lt;em&gt;scratch&lt;/em&gt;&lt;/strong&gt;.&lt;/h4&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/aghontpi/watchlist/blob/70e02ba3485dd1b957033ca33c208d10a72482c6/src/Home/Friends/TabbedView.tsx&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;code link&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;following the documentation, it was pretty simple to implement.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-typescript&#34;&gt;const translateX = useSharedValue(0);
const scrollHandler = useAnimatedScrollHandler((event) =&amp;gt; {
translateX.value = -event.contentOffset.x;
});
const activeTab = useDerivedValue(() =&amp;gt; interpolate(translateX.value, [0, -wWidth / 2], [0, 1], Extrapolate.CLAMP));
const animatedStyle = useAnimatedStyle(() =&amp;gt; {
return {
transform: [{ translateX: -translateX.value / 2 }],
};
});
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;above code handles the animation logic, then incorporating this into our style makes it perfect.&lt;/p&gt;
&lt;p&gt;Further tweaking was done just by using the &amp;lsquo;activeTab&amp;rsquo; variable. ex: changing color during animation, etc.&lt;/p&gt;
&lt;h5 id=&#34;restructuring-firebase-rules&#34;&gt;restructuring firebase &amp;amp; rules.&lt;/h5&gt;
&lt;h6 id=&#34;structuring&#34;&gt;structuring&lt;/h6&gt;
&lt;p&gt;My initial design holds up pretty good since I already had an experience. I only had to design the new data to store in exisiting structure.&lt;/p&gt;
&lt;p&gt;my hypothetical design looks like below(for extending existing to add feature friends)&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-text&#34;&gt;users/user[]
user:{
..details,
friends:friend[]
}
frind{
status: requeststed/accepted
friendssince: accpeted date
userid: from userid in the given list
}
users/friends/frind[]
users-list:{
user:
profile:
email:
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I avoided creating a new api, &amp;amp; preferred to use workaround in firebase, cuz it would have consumed a lot of my time in backend.&lt;/p&gt;
&lt;p&gt;This &lt;a href=&#34;https://firebase.google.com/docs/database/web/structure-data&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;article was greatly helpful in making decisions&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;bellow exchange pretty much sums it up.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;//bluepie.in/images/posts/march-2021/firebase-scenario.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
&lt;h6 id=&#34;rules&#34;&gt;rules&lt;/h6&gt;
&lt;ul&gt;
&lt;li&gt;any logged in user can access &amp;lsquo;new-ref&amp;rsquo;&lt;/li&gt;
&lt;li&gt;only owner of the uid can access the uid and its properties&lt;/li&gt;
&lt;li&gt;&lt;p&gt;any logged in user can access another-ref, (this is based on above article)&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;&amp;quot;ref&amp;quot;:{
&amp;quot;$uid&amp;quot;: {
&amp;quot;.read&amp;quot;: &amp;quot;auth.uid != null &amp;amp;&amp;amp; auth.uid == $uid&amp;quot;,
&amp;quot;.write&amp;quot;: &amp;quot;auth.uid != null &amp;amp;&amp;amp; auth.uid == $uid&amp;quot;,
&amp;quot;new-ref&amp;quot;: {
&amp;quot;.read&amp;quot;: &amp;quot;auth.uid != null&amp;quot;,
&amp;quot;.write&amp;quot;: &amp;quot;auth.uid != null&amp;quot;
}
}
},
&amp;quot;another-ref&amp;quot;: {
&amp;quot;.read&amp;quot;: &amp;quot;auth.uid != null&amp;quot;,
&amp;quot;.write&amp;quot;: &amp;quot;auth.uid != null&amp;quot;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;refactoring-firebase&#34;&gt;Refactoring Firebase&lt;/h4&gt;
&lt;p&gt;Since the RN app was getting bigger, It was time for refactoring the firebase part.&lt;/p&gt;
&lt;p&gt;from /root/Firebase.ts(single file) to following folder strucutre,&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;folder&lt;/th&gt;
&lt;th&gt;description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;root&lt;/td&gt;
&lt;td&gt;root directory contents&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;/Firebase/login.ts&lt;/td&gt;
&lt;td&gt;curd operations post login&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;/Firebase/friends.ts&lt;/td&gt;
&lt;td&gt;crud operatios for people realted&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;/Firebase/movie.ts&lt;/td&gt;
&lt;td&gt;crud operations for movie related&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;/Firebase/index.ts&lt;/td&gt;
&lt;td&gt;exports in a single file&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&amp;hellip;etc&lt;/td&gt;
&lt;td&gt;other&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/aghontpi/watchlist/tree/70e02ba3485dd1b957033ca33c208d10a72482c6/src/Firebase&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;Link to code/files&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;end&#34;&gt;End&lt;/h2&gt;
&lt;p&gt;I planned to take a break, ill update on it next month. untill then seeya. tc &amp;lt;3.&lt;/p&gt;</description></item><item><title>Express Api Server</title><link>//bluepie.in/2021/02/express-api-server/</link><pubDate>Sun, 21 Feb 2021 10:54:20 +0000</pubDate><guid>//bluepie.in/2021/02/express-api-server/</guid><description>
&lt;p&gt;After a hectic past two months, hope I get some free time in the upcomming months.&lt;/p&gt;
&lt;h2 id=&#34;what-is-this&#34;&gt;What is this?&lt;/h2&gt;
&lt;p&gt;This is a backend, written for one of my projects. &lt;em&gt;This was originally developed to be a private repository, I made it public this month.&lt;/em&gt; And this was my first time using typescript 100 percent for backend, my experience with it is pretty cool.&lt;/p&gt;
&lt;h2 id=&#34;stack&#34;&gt;Stack&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;express server&lt;/li&gt;
&lt;li&gt;mongodb&lt;/li&gt;
&lt;li&gt;nginx&lt;/li&gt;
&lt;li&gt;pm manager&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;framework&#34;&gt;Framework&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;model&lt;/li&gt;
&lt;li&gt;view&lt;/li&gt;
&lt;li&gt;controller&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;folder-structure&#34;&gt;Folder structure&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Name&lt;/th&gt;
&lt;th&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;src&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Source files of the server&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;src/public&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Static files to be used on client side&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;src/models&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Storing and retrieving datails from different schema, not using mongoose models&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;src/controllers&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Controllers define functions that respond to various http requests&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;src&lt;/strong&gt;/server.ts&lt;/td&gt;
&lt;td&gt;Entry point for the app&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;src/util/&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;helpers - logging, cache, ratelimit, database&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;test&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Test cases to perform before taking a new build, is also used in combination with github actions before merging the code to master branch&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;views&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Template files for rendering dynamic content to client side, since this is a api server, there is not much there in this folder.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;.env.example&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;repos.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;.github&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;CI - github actions - run test cases on pull request and report if it is safe to merge.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;cache&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Cache folder for responses that do not need to connect to database all the time.&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;explore-the-code-in-github&#34;&gt;Explore the code in github&lt;/h3&gt;
&lt;p&gt;Repository Link:&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/aghontpi/watchlist-backend&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;https://github.com/aghontpi/watchlist-backend&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;misc&#34;&gt;Misc&lt;/h3&gt;
&lt;h4 id=&#34;a-cool-library-that-i-found-useful-for-testing-api&#34;&gt;A cool library that I found useful for testing api&lt;/h4&gt;
&lt;p&gt;&lt;a href=&#34;https://www.npmjs.com/package/supertest&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;supertest&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;see the code examples below, &lt;a href=&#34;https://github.com/aghontpi/watchlist-backend/blob/104b3b1b53850c626f557a1936a68ce5bd0aa121/test/api.test.ts&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;link to source file&lt;/a&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-ts&#34;&gt;# testing routing redirect
describe(&#39;GET /asdfd/askf&#39;, () =&amp;gt; {
it(&#39;should return redirect&#39;, (done) =&amp;gt; {
request(app).get(&#39;/random&#39;).expect(302, done);
});
});
# testing api endpoint
describe(&#39;GET /top&#39;, () =&amp;gt; {
it(&#39;should return type json with 200 OK&#39;, (done) =&amp;gt; {
request(app).get(&#39;/top&#39;).expect(&#39;Content-Type&#39;, /json/).expect(200, done);
});
});
# testing rate limiting
describe(&#39;GET /top&#39;, () =&amp;gt; {
const req = request.agent(app);
it(&#39;shoult not be ratelimited&#39;, (done) =&amp;gt; {
req.get(&#39;/top&#39;).expect(200, done);
});
it(&#39;should not be ratelimited&#39;, (done) =&amp;gt; {
req.get(&#39;/top&#39;).expect(200, done);
});
it(&#39;should not be ratelimited&#39;, (done) =&amp;gt; {
req.get(&#39;/top&#39;).expect(200, done);
});
it(&#39;should not be ratelimited&#39;, (done) =&amp;gt; {
req.get(&#39;/top&#39;).expect(200, done);
});
it(&#39;should &amp;quot;be ratelimited&amp;quot;&#39;, (done) =&amp;gt; {
req.get(&#39;/top&#39;).expect(429, done);
});
});
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;merging-pull-requests-automatically-run-tests-on-bug-fixes-and-new-features&#34;&gt;Merging pull requests, automatically run tests on bug fixes and new features.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&#34;//bluepie.in/images/posts/express-api-server/pull-request-merge-after-build-success.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
&lt;h4 id=&#34;nginx-config-used-for-deploying&#34;&gt;Nginx config used for deploying&lt;/h4&gt;
&lt;p&gt;&lt;img src=&#34;//bluepie.in/images/posts/express-api-server/nginx-config-for-express-server.png&#34; alt=&#34;nginx config&#34; /&gt;&lt;/p&gt;
&lt;h4 id=&#34;pm2-managing-the-api&#34;&gt;pm2 managing the api&lt;/h4&gt;
&lt;p&gt;&lt;img src=&#34;//bluepie.in/images/posts/express-api-server/running-the-server-in-production.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
&lt;h2 id=&#34;end&#34;&gt;End&lt;/h2&gt;
&lt;p&gt;Hope this motivates my futureself in someway, keep learning and reach milestones constantly.&lt;/p&gt;</description></item><item><title>Preconfigured Binary and Installer script through Docker</title><link>//bluepie.in/2021/01/preconfigured-binary-using-docker/</link><pubDate>Fri, 29 Jan 2021 08:23:06 +0530</pubDate><guid>//bluepie.in/2021/01/preconfigured-binary-using-docker/</guid><description>
&lt;p&gt;How&amp;rsquo;s it going, good I hope!, Hope this year is a blast for you.&lt;/p&gt;
&lt;h2 id=&#34;what-is-this&#34;&gt;What is this?&lt;/h2&gt;
&lt;p&gt;Creating a preconfigured container for a precompiled binary utilizing docker.&lt;/p&gt;
&lt;h2 id=&#34;reason-motivation&#34;&gt;Reason / Motivation:&lt;/h2&gt;
&lt;p&gt;I&amp;rsquo;ve been using hugo, even since my blog migration post, the one problem that I am facing with hugo is that,&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;whenever I run update os host system,hugo version also updates, the problem with that is some features are deprecated in the new release, my site design depends upon those features. so what I was doing is constantly degrading the hugo version back to old version, before I write a post everytime.&lt;/li&gt;
&lt;li&gt;I work in new environments all the time, so downloading the appropriate version and installing takes time.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;goal&#34;&gt;goal&lt;/h2&gt;
&lt;p&gt;At the end of this venture, I should be able to&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;create a image from scratch&lt;/li&gt;
&lt;li&gt;install a required binary with its dependencies, either using source or binary distribution&lt;/li&gt;
&lt;li&gt;create a container from the image and export it&lt;/li&gt;
&lt;li&gt;upload the container image to a docker hub or something similar&lt;/li&gt;
&lt;li&gt;setup an environment using the container&lt;/li&gt;
&lt;li&gt;link the local binary executable to the binary inside the container
&lt;ul&gt;
&lt;li&gt;whenever I run the binary locally, the binary inside the container should be executed on the files
from the host system&amp;rsquo;s current path.&lt;/li&gt;
&lt;li&gt;I should be able to run the binary, with or without its parameters and environment options&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;is-this-even-possible&#34;&gt;Is this even possible?&lt;/h2&gt;
&lt;p&gt;what I am trying to achieve is completely possible using docker, its a feature completely baked into the docker core,
using &amp;lsquo;&amp;ndash;rm&amp;rsquo; with &amp;lsquo;docker -run&amp;rsquo;&lt;/p&gt;
&lt;h2 id=&#34;lets-start&#34;&gt;Lets start&lt;/h2&gt;
&lt;h3 id=&#34;choosing-the-best-base-image-i-recommend-alpine-https-hub-docker-com-alpine&#34;&gt;Choosing the best base image, I recommend &lt;a href=&#34;https://hub.docker.com/_/alpine/&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;alpine&lt;/a&gt;.&lt;/h3&gt;
&lt;p&gt;&lt;em&gt;why?&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Alpine Linux is a Linux distribution built around musl libc and BusyBox. The &lt;strong&gt;&lt;em&gt;&lt;em&gt;image is only 5 MB&lt;/em&gt;&lt;/em&gt;&lt;/strong&gt; in size and &lt;strong&gt;&lt;em&gt;&lt;em&gt;has access to a package repository&lt;/em&gt;&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id=&#34;set-up-a-container-from-alpine&#34;&gt;Set up a container from alpine&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-sh&#34;&gt;
aghontpi@elitebook:~$ docker run --name testalpine -d -it alpine:latest /bin/sh
1be3fb1ba1c46786dc5034745dcdab31c6588627c086c08f3c0ff8493d270544
aghontpi@elitebook:~$ docker ps
CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES
1be3fb1ba1c4 alpine:latest &amp;quot;/bin/sh&amp;quot; 4 seconds ago Up 3 seconds testalpine
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;login-to-the-shell-to-install-your-binary&#34;&gt;Login to the shell to install your binary&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-sh&#34;&gt;aghontpi@elitebook:~$ docker exec -it testalpine /bin/sh
/ # whoami
root
/ # apk update
fetch https://dl-cdn.alpinelinux.org/alpine/v3.13/main/x86_64/APKINDEX.tar.gz
fetch https://dl-cdn.alpinelinux.org/alpine/v3.13/community/x86_64/APKINDEX.tar.gz
v3.13.2-8-g7bb1c88019 [https://dl-cdn.alpinelinux.org/alpine/v3.13/main]
v3.13.2-9-gd3529c068e [https://dl-cdn.alpinelinux.org/alpine/v3.13/community]
OK: 13884 distinct packages available
/ # apk list vim
vim-8.2.2320-r0 x86_64 {vim} (Vim)
/ # apk add --no-cache vim
fetch https://dl-cdn.alpinelinux.org/alpine/v3.13/main/x86_64/APKINDEX.tar.gz
fetch https://dl-cdn.alpinelinux.org/alpine/v3.13/community/x86_64/APKINDEX.tar.gz
(1/5) Installing xxd (8.2.2320-r0)
(2/5) Installing lua5.3-libs (5.3.6-r0)
(3/5) Installing ncurses-terminfo-base (6.2_p20210109-r0)
(4/5) Installing ncurses-libs (6.2_p20210109-r0)
(5/5) Installing vim (8.2.2320-r0)
Executing busybox-1.32.1-r0.trigger
OK: 25 MiB in 19 packages
/ # vim test
/ # cd home
/home # wget https://github.com/gohugoio/hugo/releases/download/v0.56.3/hugo_0.56.3_Linux-64bit.tar.gz
Connecting to github.com (13.234.210.38:443)
Connecting to github-releases.githubusercontent.com (185.199.108.154:443)
saving to &#39;hugo_0.56.3_Linux-64bit.tar.gz&#39;
hugo_0.56.3_Linux-64 100% |*********************************************************************************************************************************************************************************************************************************| 11.4M 0:00:00 ETA
&#39;hugo_0.56.3_Linux-64bit.tar.gz&#39; saved
/home # ls
hugo_0.56.3_Linux-64bit.tar.gz
/home # tar -xf hugo_0.56.3_Linux-64bit.tar.gz
/home # ls
LICENSE README.md hugo hugo_0.56.3_Linux-64bit.tar.gz
/home # cp hugo /usr/bin/
/home # mkdir test
/home # cd test/hugo
/home # ls
LICENSE README.md hugo hugo_0.56.3_Linux-64bit.tar.gz test
/home # cd test/
/home/test # hugo
Building sites … WARN 2021/02/19 16:52:24 found no layout file for &amp;quot;HTML&amp;quot; for &amp;quot;taxonomyTerm&amp;quot;: You should create a template file which matches Hugo Layouts Lookup Rules for this combination.
WARN 2021/02/19 16:52:24 found no layout file for &amp;quot;HTML&amp;quot; for &amp;quot;home&amp;quot;: You should create a template file which matches Hugo Layouts Lookup Rules for this combination.
WARN 2021/02/19 16:52:24 found no layout file for &amp;quot;HTML&amp;quot; for &amp;quot;taxonomyTerm&amp;quot;: You should create a template file which matches Hugo Layouts Lookup Rules for this combination.
| EN
+------------------+----+
Pages | 3
Paginator pages | 0
Non-page files | 0
Static files | 0
Processed images | 0
Aliases | 0
Sitemaps | 1
Cleaned | 0
Total in 4 ms
/home/test # ls
public resources
/home/test # cd ..
/home # ls
LICENSE README.md hugo hugo_0.56.3_Linux-64bit.tar.gz test
/home # rm -rf ./*
/home # exit
aghontpi@elitebook:~$
aghontpi@elitebook:~$ docker container stop testalpine
testalpine
aghontpi@elitebook:~$ docker commit testalpine testalpinewithhugo/0.1
sha256:c305edf7f82a912801ae44dfe6ffe9e834e0541728295c2968ef69ad2ba9e90f
aghontpi@elitebook:~$ docker image ls testalpinewithhugo/0.1
REPOSITORY TAG IMAGE ID CREATED SIZE
testalpinewithhugo/0.1 latest c305edf7f82a 14 seconds ago 60.1MB
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;host-the-image-remotely-in-a-service-of-your-choice&#34;&gt;Host the image remotely in a service of your choice.&lt;/h3&gt;
&lt;p&gt;Then use services like &lt;a href=&#34;https://hub.docker.com&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;docker-hub&lt;/a&gt; to your private repo, it will look like below.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;//bluepie.in/images/posts/preconfigured-binary-using-docker/docker-container-export-and-upload-to-docker-hub.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
&lt;h3 id=&#34;shell-script-to-orchestrate-the-whole-thing&#34;&gt;Shell script to orchestrate the whole thing.&lt;/h3&gt;
&lt;p&gt;Didn&amp;rsquo;t want to brushup my sheel script so wrote a python script and used it as executable instead.&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://gist.github.com/aghontpi/8271dc0f28c2c844ae2a0d1e03c70bf5&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;link to the following code&lt;/a&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;#! /usr/bin/python3
import os
calling_directory = os.getcwd()
cmd = f&amp;quot;docker run --rm -it \
--user $(id -u):$(id -g) \
-v &#39;/etc/group:/etc/group:ro&#39; \
-v &#39;/etc/passwd:/etc/passwd:ro&#39; \
-v &#39;/etc/shadow:/etc/shadow:ro&#39;
-v {calling_directory}/:/tmp/ \
-e HUGO_ENV \
-p 80:1313 \
bluepie/hugo:0.1 \
/bin/sh -c &#39;cd /tmp/ &amp;amp;&amp;amp; hugo &amp;quot; + &#39; &#39;.join(sys.argv[1:]) +&amp;quot; &#39;&amp;quot;
print(cmd)
os.system(cmd)
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;finally-installation-script&#34;&gt;Finally Installation script&lt;/h3&gt;
&lt;p&gt;The code is verbose, so check it out through the link.&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://gist.github.com/aghontpi/a9f160d80923823757a9894caf37aba7&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;link to installation script&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;what the script does..&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;check if hugo and docker is already installed&lt;/li&gt;
&lt;li&gt;create .bin directory inside $HOME&lt;/li&gt;
&lt;li&gt;downloads the &lt;a href=&#34;https://gist.github.com/aghontpi/8271dc0f28c2c844ae2a0d1e03c70bf5&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;code&lt;/a&gt; and places it as executable inside $HOME/.bin/hugo&lt;/li&gt;
&lt;li&gt;adds the path $HOME/.bin to .bashrc&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;script-in-action&#34;&gt;Script in action&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-sh&#34;&gt;
aghontpi@elitebook:/tmp$ ./install-script.py
&amp;gt; docker-hugo custom binary script v0.0.1
&amp;gt; docker is installed proceeding..
&amp;gt; hugo does not exists, initiating docker pull and installation
&amp;gt; authenticating /w docker, enter credential when asked
Authenticating with existing credentials...
WARNING! Your password will be stored unencrypted in /home/aghontpi/.docker/config.json.
Configure a credential helper to remove this warning. See
https://docs.docker.com/engine/reference/commandline/login/#credentials-store
Login Succeeded
&amp;gt; pulling from docker repo
0.1: Pulling from bluepie/hugo
Digest: sha256:db54d94cfb7ad12726b1ee9f5fa7b2a2ad9d7e567021886fe2dd74e4262a43ea
Status: Image is up to date for bluepie/hugo:0.1
docker.io/bluepie/hugo:0.1
&amp;gt; getting the custom script
&amp;gt; writing to disc
&amp;gt; setting permission
&amp;gt; backup cmd -&amp;gt; cp /home/aghontpi/.bashrc /home/aghontpi/.bashrc_bkp_19022021-21:20:15
&amp;gt; modifying bashrc of user
&amp;gt; installation complete
---&amp;gt; use a new terminal to test &amp;lt;---
aghontpi@elitebook:/tmp$
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;end&#34;&gt;End&lt;/h2&gt;
&lt;p&gt;I learned a lot through this little experiment, It saves a ton of my time.&lt;/p&gt;</description></item></channel></rss>