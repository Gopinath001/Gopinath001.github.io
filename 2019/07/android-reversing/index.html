<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content=noodp><meta name=author content=Bluepie><meta name=description content="Public Journal of aghontpi"><meta name=keywords content="aghontpi bluepie Journal"><link rel=prev href=//bluepie.in/2019/06/google-ctf-2019/><link rel=next href=//bluepie.in/2019/09/docker-to-make-life-easier/><link rel=canonical href=//bluepie.in/2019/07/android-reversing/><link rel=apple-touch-icon sizes=180x180 href=//bluepie.in/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=//bluepie.in/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=//bluepie.in/favicon-16x16.png><link rel=manifest href=//bluepie.in/site.webmanifest><link rel=mask-icon href=//bluepie.in/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content=#da532c><meta name=theme-color content=#ffffff><title>Android Reversing | Bluepie&#39;s Journal</title><meta name=title content="Android Reversing | Bluepie's Journal"><link rel=stylesheet href=//bluepie.in/font/iconfont.css><link rel=stylesheet href=//bluepie.in/css/main.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"\/\/bluepie.in\/"},"articleSection":"posts","name":"Android Reversing","headline":"Android Reversing","description":"Hello! me and others reading this from the future. Status Update:So, this month I have lost a companion that was with me for the past 4 years, he is not entirely dead but let\x26rsquo;s say is not the same person he once was\x26hellip;.wait wait wait! I am talking about my laptop. I was doing an all-nighter \x26amp; I think it was about 4 a.m. or so I was planning to go to sleep, so so while I was cleaning up \x26amp; I dropped the laptop from my waist height, I was one of the tallest persons in my class so that explains a lot.","inLanguage":"en-us","author":"Bluepie","creator":"Bluepie","publisher":"Bluepie","accountablePerson":"Bluepie","copyrightHolder":"Bluepie","copyrightYear":"2019","datePublished":"2019-07-30 22:40:21 \x2b0530 IST","dateModified":"2019-07-30 22:40:21 \x2b0530 IST","url":"\/\/bluepie.in\/2019\/07\/android-reversing\/","wordCount":"1135","keywords":["Bluepie\x27s Journal"]}</script></head><body><div class=wrapper><nav class=navbar><div class=container><div class="navbar-header header-logo"><a href=javascript:void(0); class=theme-switch><i class="extra extra-moon"></i></a>&nbsp;<a href=//bluepie.in/>Bluepie&#39;s Journal</a></div><div class="menu navbar-right"><a class=menu-item href=//bluepie.in/posts/>My Journal</a>
<a class=menu-item href=//bluepie.in/categories/>Categories</a></div></div></nav><nav class=navbar-mobile id=nav-mobile style=display:none><div class=container><div class=navbar-header><div><a href=javascript:void(0); class=theme-switch><i class="extra extra-moon"></i></a>&nbsp;<a href=//bluepie.in/>Bluepie&#39;s Journal</a></div><div class=menu-toggle><span></span><span></span><span></span></div></div><div class=menu id=mobile-menu><a class=menu-item href=//bluepie.in/posts/>My Journal</a>
<a class=menu-item href=//bluepie.in/categories/>Categories</a></div></div></nav><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-135013873-2','auto');ga('send','pageview');}</script><main class=main><div class=container><article class=post-warp itemscope itemtype=http://schema.org/Article><header class=post-header><h1 class=post-title itemprop="name headline">Android Reversing</h1><div class=post-meta>Written by <a itemprop=name href=//bluepie.in/ rel=author>Bluepie</a> with â™¥
<span class=post-time>on <time datetime=2019-07-30 itemprop=datePublished>July 30, 2019</time></span>
in
<i class="iconfont icon-folder"></i><span class=post-category><a href=//bluepie.in/categories/tech/>Tech</a>
<a href=//bluepie.in/categories/reversing/>Reversing</a>
<a href=//bluepie.in/categories/android/>android</a></span></div></header><div class=post-content><img src=//bluepie.in/images/posts/android-rev.png class=featured_image><blockquote><p>Hello! me and others reading this from the future. <strong><em>Status Update:So, this month I have lost a companion that was with me for the past 4 years, he is not entirely dead but let&rsquo;s say is not the same person he once was&hellip;.wait wait wait! I am talking about my laptop. I was doing an all-nighter &amp; I think it was about 4 a.m. or so I was planning to go to sleep, so so while I was cleaning up &amp; I dropped the laptop from my waist height, I was one of the tallest persons in my class so that explains a lot. I should have cleaned everything in the morning. Anyway after that I couldn&rsquo;t work on my projects for sometime, but I fixed it to a point where it is somewhat workable, bit its not the same, I have to buy a new one. Next time when I make a post it will be on a new laptop.</em></strong></p></blockquote><hr><h2 id=goal>Goal</h2><p>I have been away from reversing, ctf and modding, basically my hobbies from my University days. but occasionally I do some reversing and CTF&rsquo;s, <em>because of course I don&rsquo;t want to forget everything.</em> I was busy with my office work but in the back of my mind there was always thoughts about reversing apps again usually to find bugs and exploit in myself for fun. That is the GOAL!.</p><h2 id=motivaation>Motivaation</h2><p>The next thing that Lead me to writing this post is that I use torrents sometimes and i mostly do it in my phone. Out of all the Torrent clients I used, ttorrent is the best(phone). I use it but not to the point of im going to buy it(the premium app without adds).</p><p>Lately ads are just awefull, full-blown full screen ads with full audio and you cannot even skip the video. So in one weekend I decided to reverse it, because at this point you cannot use it.</p><h3 id=question>Question</h3><p>Why not use mods/cracks from the internet,</p><p>answer: easy, since I&rsquo;m also in the security community I know for a fact that almost every other mod has some Trojan linked with it and the other reason is I am paranoid.</p><hr><h2 id=warning-or-notice-whatever-you-want-to-call-it>WARNING OR NOTICE WHATEVER YOU WANT TO CALL IT</h2><p>What I am going to share below is purely for myself to remind me(future me) that at some point in life I did this and is purely for learning purposes for anyone else that might stumbled upon this.</p><h2 id=decompiling>Decompiling</h2><h3 id=fun-part>Fun part</h3><p>Note: I have already done this before and I have a personal preference of tools that I use.</p><p>First thing that you need is the decompiler, at the time of writing this post I have seen around 15 or so decompilers online and offline for android ofcourse personally i have been fan of APK tool its just perfect.</p><p><a href=https://bitbucket.org/iBotPeaches/apktool/downloads rel="nofollow noreferrer" target=_blank>apktool download link</a></p><p>Some of the Honorable mentions</p><ul><li>cfr decompiler</li><li>jd-gui</li><li>jadx</li></ul><h4 id=apktool-usage>Apktool usage</h4><h5 id=its-simple-apktool-d-for-decompile-o-outputdirectory>its simple. apktool d(for decompile) -o(outputdirectory)</h5><pre><code class=language-console>
java -jar apktook_2.4.0.jar d -o output_dir/ apkfile.apk

</code></pre><p>after you decompile the APK. Explore the decompiled folder for some time.
If you want to to change the app flow or know its secrets, you have to to change those files so you need a text editor with find in files feature. My personal preference for this is Sublime course you can use anything you like.</p><p>So Android apps are basically written in Java and kotlin from native app standpoint. So the files that you saw in those folders are just the compiled versions of the source. For seeing the source code of apps, you cannot see the exact source code from Java everything will be obfuscated and a lot of it will not make any sense to you if you don&rsquo;t have any experience at first so don&rsquo;t be afraid of it. Be very vigilant here I am talking about two things one is the Java source files and the other is the compiled .smali files.</p><p><em>.smali modifications are the most imporatant one, that matters in this post. since that will be used to change the app flow.</em></p><hr><h2 id=modding>Modding</h2><h3 id=smali-modifications>smali modifications</h3><p>This is the tough spot. I have previous experience with assembly(x86 and dex) but for other people you have to learn to understand it.</p><h4 id=viewing-logic-and-instructions>viewing logic and instructions</h4><p>personally, i use jadx for viewing the java code(obfuscated and confusing) and viewing the smali code at the same time and make changes with text editors on .smali files.</p><p><a href=https://github.com/skylot/jadx rel="nofollow noreferrer" target=_blank>jadx link</a></p><p><strong><em>for smali modifications to understand the instructions.i&rsquo;ve found this to be useful than the google one.</em></strong></p><p><a href=http://pallergabor.uw.hu/androidblog/dalvik_opcodes.html rel="nofollow noreferrer" target=_blank>dalvik_opcodes</a></p><h3 id=understanding-structure-and-finding-things-to-be-changed-to-suit-our-needs>Understanding structure and finding things to be changed to suit our needs</h3><p>So with the command form the apktool part, you would have decompiled the apk, with the help of tools provided above you can also now just view the source and hopefully understand the logic. I am going to tell what i changed after analysing it.</p><p>hint: ttorrent lite can be converted to premium if you have a code, that might be exploitable.</p><pre><code class=language-text>    .locals 0

    .line 1
    iput-object p1, p0, Lhu/tagsoft/ttorrent/serial/a;-&gt;c:Lhu/tagsoft/ttorrent/serial/SerialActivity;

    iput-boolean p2, p0, Lhu/tagsoft/ttorrent/serial/a;-&gt;a:Z

    &gt;.local 0, means no extra variables will be included,

    to make conditions true, set variable true,
</code></pre><h4 id=basically-what-u-have-to-do-in-terms-of-java-code-is-below-this-is-one-of-the-common-modding-pattern><em>basically what u have to do in terms of java code is below</em> this is one of the common modding pattern</h4><pre><code class=language-java>
    public Boolean isLicenseVerified{
        this.licenseCheck = getLicenseCheck();
        return this.licecseCheck //true if bought the license.
    }

    public Boolean isLicenseVerified{
        this.licenseCheck = true;
        return this.licecseCheck //always true.
    }

</code></pre><h4 id=in-smali-code-that-would-translate-to-actual-change-made-in-code>in smali code that would translate to, actual change made in code.</h4><pre><code class=language-text>    ex:
    .local 1 //now one extra variable can be created.

     const/4 v0, 0x1

     iput-boolean v0, p0, Lhu/tagsoft/ttorrent/serial/a;-&gt;a:Z //the variable was set to true.

    !imp calling to check if serial registered, always return true. successful patch!.
</code></pre><p>NOTE: this is not an easy to do at the begining, I was at that point myself so just dont give up.</p><hr><h2 id=recompiling>Recompiling</h2><p>After that you have to recompile the app, There are several ways to do this, I am gonna go with removing the original signature of the app creating a new key and then signing the app with your key.</p><h3 id=removemeta-inf-folder-to-remove-original-signatures>removemeta inf folder to remove original signatures</h3><pre><code class=language-console>
java -jar apktool b -o  outputdir/filename.apk decompiledDirectory/

</code></pre><hr><h2 id=resigning>Resigning</h2><h4 id=creating-key-and-signing-with-it>creating key and signing with it</h4><pre><code class=language-console>
keytool -genkey -v -keystore ck-release-key.keystore -alias ck -keyalg RSA -keysize 2048 -validity 10000

//resign the apk

jarsigner -verbose -sigalg SHA1withRSA -digestalg SHA1 -keystore ck-release-key.keystore my_application.apk ck

//be sure to verify it there might be some errors.

jarsigner -verify -verbose recompiledApk.apk

</code></pre><h4 id=there-is-also-another-way-of-disabling-ads-simpler-very-much-simpler-by-disabling-the-activity-from-manifest-but-what-is-the-fun-in-that>there is also another way of disabling ads simpler(very much simpler) by disabling the activity from manifest but what is the fun in that</h4><blockquote><p><strong><em>Now got rid of the pesky fullScreen ads, I am not gona share the apk here, cuz reasons duh&hellip;</em></strong> <em>but I taught u the necessary stuff to do so, you should do fine on your own</em></p></blockquote></div><div class=post-copyright><p class=copyright-item><span>Author:</span>
<span>Bluepie</span></p><p class=copyright-item><span>Link:</span>
<a href=//bluepie.in/2019/07/android-reversing/>//bluepie.in/2019/07/android-reversing/</span></p></div><div class=post-tags><section><a href=javascript:window.history.back();>back</a></span> Â·
<span><a href=//bluepie.in/>home</a></span></section></div><div class=post-nav><a href=//bluepie.in/2019/06/google-ctf-2019/ class=prev rel=prev title="Google Ctf 2019"><i class="iconfont icon-left"></i>&nbsp;Google Ctf 2019</a>
<a href=//bluepie.in/2019/09/docker-to-make-life-easier/ class=next rel=next title="Docker to Make Life Easier">Docker to Make Life Easier&nbsp;<i class="iconfont icon-right"></i></a></div><div class=post-comment><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"gopinath001-github-io-blog"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></article></div></main><footer class=footer><div class=copyright>&copy;
<span itemprop=copyrightYear>2017 - 2021</span>
<span class=with-love>|</span>
<span class=author itemprop=copyrightHolder><a href=//bluepie.in/>Bluepie</a></span></div></footer><script src=//bluepie.in/js/vendor_no_gallery.min.js async></script></div></body></html>