<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta name=author content="Bluepie"><link rel=prev href=//bluepie.in/2019/04/android-service-binders/><link rel=next href=//bluepie.in/2019/06/google-ctf-2019/><link rel=canonical href=//bluepie.in/2019/05/modsecurity/><link rel=apple-touch-icon sizes=180x180 href=//bluepie.in/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=//bluepie.in/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=//bluepie.in/favicon-16x16.png><link rel=manifest href=//bluepie.in/site.webmanifest><link rel=mask-icon href=//bluepie.in/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><title>ModSecurity | Bluepie's update blog</title><meta name=title content="ModSecurity | Bluepie's update blog"><link rel=stylesheet href=//bluepie.in/font/iconfont.css><link rel=stylesheet href=//bluepie.in/css/main.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"\/\/bluepie.in\/"},"articleSection":"posts","name":"ModSecurity","headline":"ModSecurity","description":"so hello.. how are you doing..? how is life? im good, thank you!. Status Update: I\x26rsquo;ve seen better days tbh, i\x26rsquo;ve faced a lot of challenges this month, im having burnout? wtf! what is that? you ask\x26rsquo;? just google it.. In the entirety of my life, i never hated computers and programming\/ developing in general, but recently i grown a haterd to computers and coding disgusts me.. like WTH? im like the polar opposite of myself, i never thought i would reach this moment in life, funny is\x26rsquo;nt it?","inLanguage":"en-us","author":"Bluepie","creator":"Bluepie","publisher":"Bluepie","accountablePerson":"Bluepie","copyrightHolder":"Bluepie","copyrightYear":"2019","datePublished":"2019-05-24 23:32:43 \x2b0530 IST","dateModified":"2019-05-24 23:32:43 \x2b0530 IST","url":"\/\/bluepie.in\/2019\/05\/modsecurity\/","wordCount":"869","keywords":["Bluepie\x27s update blog"]}</script></head><body><div class=wrapper><nav class=navbar><div class=container><div class="navbar-header header-logo"><a href=javascript:void(0); class=theme-switch><i class="extra extra-moon"></i></a>&nbsp;<a href=//bluepie.in/>Bluepie's update blog</a></div><div class="menu navbar-right"><a class=menu-item href=//bluepie.in/posts/>Blog</a>
<a class=menu-item href=//bluepie.in/categories/>Categories</a></div></div></nav><nav class=navbar-mobile id=nav-mobile style=display:none><div class=container><div class=navbar-header><div><a href=javascript:void(0); class=theme-switch><i class="extra extra-moon"></i></a>&nbsp;<a href=//bluepie.in/>Bluepie's update blog</a></div><div class=menu-toggle><span></span><span></span><span></span></div></div><div class=menu id=mobile-menu><a class=menu-item href=//bluepie.in/posts/>Blog</a>
<a class=menu-item href=//bluepie.in/categories/>Categories</a></div></div></nav><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-135013873-2','auto');ga('send','pageview');}</script><main class=main><div class=container><article class=post-warp itemscope itemtype=http://schema.org/Article><header class=post-header><h1 class=post-title itemprop="name headline">ModSecurity</h1><div class=post-meta>Written by <a itemprop=name href=//bluepie.in/ rel=author>Bluepie</a> with ♥
<span class=post-time>on <time datetime=2019-05-24 itemprop=datePublished>May 24, 2019</time></span>
in
<i class="iconfont icon-folder"></i><span class=post-category><a href=//bluepie.in/categories/tech/>Tech</a>
<a href=//bluepie.in/categories/networking/>Networking</a>
<a href=//bluepie.in/categories/security/>Security</a></span></div></header><div class=post-content><img src=//bluepie.in/images/posts/modsecurity_audit.png class=featured_image><blockquote><p>so hello.. how are you doing..? how is life? im good, thank you!.
<em><strong>Status Update: I&rsquo;ve seen better days tbh, i&rsquo;ve faced a lot of challenges this month, im having burnout? wtf! what is that? you ask&rsquo;? just google it.. In the entirety of my life, i never hated computers and programming/ developing in general, but recently i grown a haterd to computers and coding disgusts me.. like WTH? im like the polar opposite of myself, i never thought i would reach this moment in life, funny is&rsquo;nt it? plus i&rsquo;ve been going to my old happits - i blame being human for that.. i can never forget something and get over it can&rsquo;t I.</strong></em></p></blockquote><p><em><strong>Thankfully for burnout I got people on my back, with their help and advice, i&rsquo;ve been taking breaks but the breaks are not enough, goto go to work?!! i miss old days.</strong></em></p><hr><h2 id=-ive-had-a-chance-to-work-on-modsecurity-and-im-greatfull-for-that-i-gained-a-new-skill-kudos>> I&rsquo;ve had a chance to work on modSecurity and im greatfull for that! I gained a new skill! kudos!!.</h2><hr><h3 id=why>Why?</h3><p>what is modSec? modSecurity is a waf, waf is like anti virus for servers, controls how the servers responds to requests and what responses are sent out. modSecurity is openSource so using is completely free and it is a must in pci compliance, modSec works based on rules that fine tuned, identified as malicious and are wrote down, the rules are the building blocks of modsecurity. a better rule set equals better protection, this is why you see many vendors who branched out from modSecurity and provide their own set of rules as their enterprise solutions like for example: atomicorp, mlware expert, Trustwave, trend micro, etc.</p><p>if you want to know about modsecurity you should know a little bit of history of mod security, the rule set history, the latest in the rules of modSecurity is the core rule set 3.0+, before this release, the modSecrity rules create many false positives, but after update some big changes are the new blocking mode, curated rule-set and better detection.</p><h3 id=so-what-is-the-new-blocking-mode>So what is the new blocking mode?</h3><p>By default the anomaly scoring mode(new blocking mode) is activated, with
&ldquo;SecRuleEngine DetectionOnly&rdquo;, you have to turn this to &ldquo;SecRuleEngine On&rdquo;
to block the malicious requests. <em><strong>(first of all you install modSecurity, leave the detection phase on, collect some logs - analyse them - tweak the rules - then turn on the secRuleEngine..)</strong></em></p><p>if SecDefaultAction is set to “phase:2,deny,log&rdquo; then modSecurity is working by anomaly scoring mode. next thing you must know about is &ldquo;Anomaly scoring severity levels&rdquo; and " Anomaly scoring threshold levels&rdquo; (for blocking mostly)</p><h4 id=what-it-does>what it does?</h4><p>It does not block the request immediately but allows the request to pass through after assigning a score to the request, if the request any other rules another score is added to it, so there are 5 different levels where the rules are applied to the request, the scores are evaluated at the phase 3 for Inbound rules and 4 for outbound requests, yea you are right modsec scans the output content too and slaps score on it, if it sees something malicious.
the rules are present in the rule-set too as</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>SecAction “phase:1,id:’981208’,t:none,nolog,pass,<span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>setvar:tx.inbound_anomaly_score_level<span style=color:#f92672>=</span>5”
SecAction “phase:1,id:’981209’,t:none,nolog,pass,<span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>setvar:tx.outbound_anomaly_score_level<span style=color:#f92672>=</span>4”
</code></pre></div><p>the inbound rules files are present in the file named along the line of &ldquo;inbound_blocking.conf&rdquo; and same as for the outbound request &ldquo;outbound_blocking.conf&rdquo;.</p><p>Based on severity anomaly scoring mode has different levels with scores by default</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#960050;background-color:#1e0010>CRITICAL</span> <span style=color:#960050;background-color:#1e0010>with</span> <span style=color:#960050;background-color:#1e0010>a</span> <span style=color:#960050;background-color:#1e0010>score</span> <span style=color:#960050;background-color:#1e0010>of</span> <span style=color:#ae81ff>5</span>
<span style=color:#960050;background-color:#1e0010>Error</span> <span style=color:#960050;background-color:#1e0010>with</span> <span style=color:#ae81ff>4</span><span style=color:#960050;background-color:#1e0010>,</span>
<span style=color:#960050;background-color:#1e0010>warning</span> <span style=color:#960050;background-color:#1e0010>with</span> <span style=color:#ae81ff>3</span><span style=color:#960050;background-color:#1e0010>,</span>
<span style=color:#960050;background-color:#1e0010>notice</span> <span style=color:#960050;background-color:#1e0010>with</span> <span style=color:#ae81ff>2</span><span style=color:#960050;background-color:#1e0010>,</span>
</code></pre></div><hr><h3 id=note-modsecurity-must-be-tweaked-to-individual-applications-not-just-install-the-default-configuration-infact-the-authors-of-modsecurity-strongly-advice-this-too>>Note: modSecurity must be tweaked to individual applications, not just install the default configuration, infact the authors of modsecurity strongly advice this too.</h3><h3 id=about-audit-logs---someother-aspects>About audit logs - SomeOther aspects.</h3><p>Audit logs provide the entire traffic data <em><strong>if &ldquo;logging is enabled that is&rdquo;.</strong></em></p><h5 id=if-response-code-is-500-we-are-logging-that>if response code is 500 we are logging that.</h5><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>SecAuditLogRelevantStatus “^<span style=color:#f92672>(</span>?:5|4<span style=color:#f92672>(</span>?!04<span style=color:#f92672>))</span>”
</code></pre></div><h5 id=the-following-parts-contain-the-necessary-information-for-each-request>the following parts contain the necessary information for each request.</h5><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>SecAuditLogParts ABCEFHZ
• A: Audit log header
• B: Request headers
• C: Request body
• E: Intended response body
• F: Response headers
• H: Audit log trailer
• Z: Audit log footer
</code></pre></div><h3 id=while-logging---sensitive-data-in-logs>While logging - Sensitive Data in Logs</h3><p>Be careful while logging the data, sensitive data are captured in logs too like passwords, creditcard numbers, you dont want that do you?</p><p>the below log you see credit card number captured in part c.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#960050;background-color:#1e0010>-</span><span style=color:#ae81ff>-8472</span><span style=color:#960050;background-color:#1e0010>b</span><span style=color:#ae81ff>290</span><span style=color:#960050;background-color:#1e0010>-C--</span>
<span style=color:#960050;background-color:#1e0010>paymentType=default&amp;_D%</span><span style=color:#ae81ff>3</span><span style=color:#960050;background-color:#1e0010>ApaymentType=+&amp;</span>
<span style=color:#960050;background-color:#1e0010>creditCardNumber=***************&amp;_D%</span><span style=color:#ae81ff>3</span><span style=color:#960050;background-color:#1e0010>AcreditCardNumber=+&amp;cid=</span><span style=color:#ae81ff>6802</span>
<span style=color:#960050;background-color:#1e0010>&amp;_D%</span><span style=color:#ae81ff>3</span><span style=color:#960050;background-color:#1e0010>Acid=+&amp;selCreditCardType=Visa&amp;_D%</span><span style=color:#ae81ff>3</span><span style=color:#960050;background-color:#1e0010>AselCreditCardType</span>
<span style=color:#960050;background-color:#1e0010>=+&amp;_D%</span><span style=color:#ae81ff>3</span><span style=color:#960050;background-color:#1e0010>AexpirationMonth=+&amp;expirationMon</span>
</code></pre></div><p>you can mitigate this with a rule like</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#960050;background-color:#1e0010>SecRule</span> <span style=color:#960050;background-color:#1e0010>&amp;ARGS:password</span> <span style=color:#960050;background-color:#1e0010>“@eq</span> <span style=color:#ae81ff>1</span><span style=color:#960050;background-color:#1e0010>”</span> <span style=color:#960050;background-color:#1e0010>“phase:</span><span style=color:#ae81ff>5</span><span style=color:#960050;background-color:#1e0010>,t:none,id:’</span><span style=color:#ae81ff>901</span><span style=color:#960050;background-color:#1e0010>’,nolog,pass,\</span>
<span style=color:#960050;background-color:#1e0010>sanitiseInput:pwd</span>
</code></pre></div><p>now in audit log c section,</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#960050;background-color:#1e0010>--c</span><span style=color:#ae81ff>983684</span><span style=color:#960050;background-color:#1e0010>a-C--</span>
<span style=color:#960050;background-color:#1e0010>log=admin&amp;password=********&amp;submit=Login+%C</span><span style=color:#ae81ff>2</span><span style=color:#960050;background-color:#1e0010>%BB&#34;</span>
</code></pre></div><p>with the rule applied the password is now obscured.</p><h3 id=vitual-patching>vitual Patching</h3><p>So ModSecurity has a ton of features you should not miss out is virtual patching, where would you use this you ask? well.. you found a vulnerability in your application and while you wait for the developers to fix that you could do virutual patching with the wide variety of rules available in modSecurity.</p><hr><blockquote><p><em><strong>The post is getting huge and I find writing blogs tiresome (bad at typing i guess). but i still do it cuz its for the future me.</strong></em></p></blockquote><p><em><strong>I didn&rsquo;nt cover everything and i assumed u knew little about modSecurity during halfway, I just couln&rsquo;t type the whole entirety, just contact me if you want to know more&mldr;bye!</strong></em></p></div><div class=post-copyright><p class=copyright-item><span>Author:</span>
<span>Bluepie</span></p><p class=copyright-item><span>Link:</span>
<a href=//bluepie.in/2019/05/modsecurity/>//bluepie.in/2019/05/modsecurity/</span></p></div><div class=post-tags><section><a href=javascript:window.history.back();>back</a></span> ·
<span><a href=//bluepie.in/>home</a></span></section></div><div class=post-nav><a href=//bluepie.in/2019/04/android-service-binders/ class=prev rel=prev title="Android Service Binders"><i class="iconfont icon-left"></i>&nbsp;Android Service Binders</a>
<a href=//bluepie.in/2019/06/google-ctf-2019/ class=next rel=next title="Google Ctf 2019">Google Ctf 2019&nbsp;<i class="iconfont icon-right"></i></a></div><div class=post-comment><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"gopinath001-github-io-blog"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></article></div></main><footer class=footer><div class=copyright>&copy;
<span itemprop=copyrightYear>2017 - 2020</span>
<span class=with-love>|</span>
<span class=author itemprop=copyrightHolder><a href=//bluepie.in/>Bluepie</a></span></div></footer><script src=//bluepie.in/js/vendor_no_gallery.min.js async></script></div></body></html>